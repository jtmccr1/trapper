(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{39:function(t,e,n){t.exports=n.p+"static/media/logo.a9ecf903.png"},41:function(t,e,n){t.exports=n(59)},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var a=n(0),i=n.n(a),r=n(38),o=n.n(r),s=n(3),c=n(6),l=n(32),u=n(9),h=n(8),d=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;Object(u.a)(this,t);var a=new Map([].concat(Object(s.a)(t.DEFAULT_MAP()),Object(s.a)(n)));if(this.symptomOnset=e[a.get("symptomOnset")]?e[a.get("symptomOnset")]:"Unknown",this.sampleDate=e[a.get("sampleDate")]?e[a.get("sampleDate")]:"Unknown",this.resolution=e[a.get("resolution")]?e[a.get("resolution")]:"Unknown",this.resoultionDate=e[a.get("resolutionDate")]?e[a.get("resolutionDate")]:"Unknown",this.id=e[a.get("id")]?e[a.get("id")]:"Unknown",this.location=e[a.get("location")]?e[a.get("location")]:"Unknown",this.caseId=Symbol(),Object.keys(e).filter(function(t){return-1===Object(s.a)(a.values()).indexOf(t)}).length>1){this.metadata={};var i=!0,r=!1,o=void 0;try{for(var c,l=Object.keys(e).filter(function(t){return-1===Object(s.a)(a.values()).indexOf(t)})[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var h=c.value;this.metadata[h]=e[h]}}catch(d){r=!0,o=d}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}}}return Object(h.a)(t,null,[{key:"DEFAULT_MAP",value:function(){return new Map([["symptomOnset","symptomOnset"],["sampleDate","sampleDate"],["resolution","resolution"],["resolutionDate","resolutionDate"],["id","id"],["location","location"]])}}]),Object(h.a)(t,[{key:"getSymptomOnset",value:function(){return new Date(this.symptomOnset.valueOf())}},{key:"getSampleDate",value:function(){return this.sampleDate.map(function(t){return new Date(t.valueOf())})}},{key:"getResolution",value:function(){return this.resolution}},{key:"getResolutionDate",value:function(){return new Date(this.resolutionDate.valueOf())}},{key:"getId",value:function(){return this.id}},{key:"getCaseId",value:function(){return this.caseId}},{key:"getLocation",value:function(){return this.location}}]),t}(),g=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;Object(u.a)(this,t);var a=new Map([].concat(Object(s.a)(t.DEFAULT_MAP()),Object(s.a)(n)));this.target=e[a.get("target")]?e[a.get("target")]:"Unknown",this.source=e[a.get("source")]?e[a.get("source")]:"Unknown",this.dataSource=e[a.get("dataSource")]?e[a.get("dataSource")]:"Unknown",this.metadata={};var i=!0,r=!1,o=void 0;try{for(var c,l=Object.keys(e).filter(function(t){return-1===Object(s.a)(a.values()).indexOf(t)})[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var h=c.value;this.metadata[h]=e[h]}}catch(d){r=!0,o=d}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}}return Object(h.a)(t,null,[{key:"DEFAULT_MAP",value:function(){return new Map([["target","target"],["source","source"],["dataSource","dataSource"]])}}]),t}(),f=n(27),v=Object(f.b)("%Y-%m-%d");var p=n(14),b=n(5),y=n(4),m=n(20),O=n(39),x=n.n(O);var j=function(){return i.a.createElement("div",{className:"header"},i.a.createElement("div",{className:"logo"},i.a.createElement("a",{href:"http://artic.network",target:"_blank",rel:"noopener noreferrer"},i.a.createElement("img",{src:x.a,alt:"logo",width:"40"}))),i.a.createElement("div",{className:"title"},i.a.createElement("h2",{style:{marginTop:"0px",marginBottom:"8px"}},i.a.createElement("span",{style:{fontSize:"1.8em"}},"TRAPPER"),i.a.createElement("span",null," Transmission Reconstruction And Phylogenetics Promoting Early Response"))))},k=n(11),E=n(17),w=n(16),S=n(18),T=n(19),N=n(2),A=n(23),L=n(13),R=n.n(L),D={DISCRETE:Symbol("DISCRETE"),BOOLEAN:Symbol("BOOLEAN"),INTEGER:Symbol("INTEGER"),FLOAT:Symbol("FLOAT"),PROBABILITIES:Symbol("PROBABILITIES")},C=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,t),this.root=n,this.annotations={},this.nodeList=Object(s.a)(this.preorder()),this.nodeList.forEach(function(t,n){t.label&&t.label.startsWith("#")?t.id=t.label.substring(1):t.id="node_".concat(n),e.addAnnotations(t.annotations)}),this.nodeMap=new Map(this.nodeList.map(function(t){return[t.id,t]})),this.tipMap=new Map(this.externalNodes.map(function(t){return[t.name,t]})),this.nodeLabelMap=new Map([].concat(Object(s.a)(this.internalNodes.map(function(t){return[t.label,t]})),Object(s.a)(this.externalNodes.map(function(t){return[t.name,t]})))),this.treeUpdateCallback=function(){}}return Object(h.a)(t,[{key:"getSibling",value:function(t){return t.parent?t.parent.children.find(function(e){return e!==t}):null}},{key:"getNode",value:function(t){return this.nodeMap.get(t)}},{key:"getNodeFromLabel",value:function(t){return this.nodeLabelMap.get(t)}},{key:"getExternalNode",value:function(t){return this.tipMap.get(t)}},{key:"preorder",value:R.a.mark(function t(){var e;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=R.a.mark(function t(e){var n,a,i,r,o,s;return R.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,e;case 2:if(!e.children){c.next=28;break}n=!0,a=!1,i=void 0,c.prev=6,r=e.children[Symbol.iterator]();case 8:if(n=(o=r.next()).done){c.next=14;break}return s=o.value,c.delegateYield(t(s),"t0",11);case 11:n=!0,c.next=8;break;case 14:c.next=20;break;case 16:c.prev=16,c.t1=c.catch(6),a=!0,i=c.t1;case 20:c.prev=20,c.prev=21,n||null==r.return||r.return();case 23:if(c.prev=23,!a){c.next=26;break}throw i;case 26:return c.finish(23);case 27:return c.finish(20);case 28:case"end":return c.stop()}},t,null,[[6,16,20,28],[21,,23,27]])}),t.delegateYield(e(this.root),"t0",2);case 2:case"end":return t.stop()}},t,this)})},{key:"postorder",value:R.a.mark(function t(){var e;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=R.a.mark(function t(e){var n,a,i,r,o,s;return R.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!e.children){c.next=26;break}n=!0,a=!1,i=void 0,c.prev=4,r=e.children[Symbol.iterator]();case 6:if(n=(o=r.next()).done){c.next=12;break}return s=o.value,c.delegateYield(t(s),"t0",9);case 9:n=!0,c.next=6;break;case 12:c.next=18;break;case 14:c.prev=14,c.t1=c.catch(4),a=!0,i=c.t1;case 18:c.prev=18,c.prev=19,n||null==r.return||r.return();case 21:if(c.prev=21,!a){c.next=24;break}throw i;case 24:return c.finish(21);case 25:return c.finish(18);case 26:return c.next=28,e;case 28:case"end":return c.stop()}},t,null,[[4,14,18,26],[19,,21,25]])}),t.delegateYield(e(this.root),"t0",2);case 2:case"end":return t.stop()}},t,this)})},{key:"toNewick",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootNode;return(e.children?"(".concat(e.children.map(function(e){return t.toNewick(e)}).join(","),")").concat(e.label?e.label:""):e.name)+(e.length?":".concat(e.length):"")}},{key:"reroot",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(t!==this.rootNode){var a=this.rootNode.children[0].length+this.rootNode.children[1].length;if(t.parent!==this.rootNode)!function(){for(var i=t,r=t.parent,o=[],c=r.children[0]===t,l=t,u=r,h=r.length;r.parent;){if(r.children=r.children.filter(function(t){return t!==i}),r.parent===e.rootNode){var d=e.getSibling(r);r.children.push(d),d.length=a}else{var g=[h,r.parent.length];r.parent.length=g[0],h=g[1],r.children.push(r.parent)}o=[r].concat(Object(s.a)(o)),i=r,r=r.parent}e.rootNode.children=c?[l,u]:[u,l],e.internalNodes.forEach(function(t){t.children.forEach(function(e){e.parent=t})});var f=l.length*n;u.length=f,l.length=l.length-f}();else{var i=t.length*(1-n);t.length=i,this.getSibling(t).length=a-i}this.treeUpdateCallback()}}},{key:"rotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.children){if(e){var n=!0,a=!1,i=void 0;try{for(var r,o=t.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;this.rotate(s,e)}}catch(c){a=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}t.children.reverse()}this.treeUpdateCallback()}},{key:"order",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootNode,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var i=n?1:-1;var r=0;if(e.children){var o=new Map,s=!0,c=!1,l=void 0;try{for(var u,h=e.children[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,g=t(d,n,a);o.set(d,g),r+=g}}catch(f){c=!0,l=f}finally{try{s||null==h.return||h.return()}finally{if(c)throw l}}e.children.sort(function(t,e){return(o.get(t)-o.get(e))*i}),a&&a()}else r=1;return r}).call(this,t,e),this.treeUpdateCallback()}},{key:"lastCommonAncestor",value:function(e,n){var a=Object(s.a)(t.pathToRoot(e)),i=Object(s.a)(t.pathToRoot(n));return a.filter(function(t){return i.map(function(t){return t.id}).indexOf(t.id)>-1}).reduce(function(t,e){return t.level>e.level?t:e})}},{key:"pathLength",value:function(t,e){for(var n=0,a=this.lastCommonAncestor(t,e),i=0,r=[t,e];i<r.length;i++)for(var o=r[i];o!=a;)n+=o.length,o=o.parent;return n}},{key:"rootToTipLength",value:function(e){var n=0,a=!0,i=!1,r=void 0;try{for(var o,s=t.pathToRoot(e)[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;c.length&&(n+=c.length)}}catch(l){i=!0,r=l}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return n}},{key:"rootToTipLengths",value:function(){var t=this;return this.externalNodes.map(function(e){return t.rootToTipLength(e)})}},{key:"splitBranches",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(s.a)(this.preorder()).filter(function(t){return t.parent}).forEach(function(n){if(null!==e){if(e[n.id]){var a=n;e[n.id].forEach(function(e){var n=Object(c.a)(e,2),i=n[0],r=n[1];(a=t.splitBranch(a,i)).id=r})}}else t.splitBranch(n,n.length/2)})}},{key:"splitBranch",value:function(t,e){var n=t.length,a={parent:t.parent,children:[t],length:n-e,annotations:{midpoint:!0}};return t.parent.children[t.parent.children.indexOf(t)]=a,t.parent=a,t.length=e,a}},{key:"annotateTips",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1],s=this.getExternalNode(r);if(!s)throw new Error("tip with label ".concat(r," not found in tree"));this.annotateNode(s,o)}}},{key:"annotateNodes",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1],s=this.getNode(r);if(!s)throw new Error("tip with key ".concat(r," not found in tree"));this.annotateNode(s,o)}}},{key:"annotateNodesFromLabel",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1],s=this.getNodeFromLabel(r);if(!s)throw new Error("tip with key ".concat(r," not found in tree"));this.annotateNode(s,o)}}},{key:"annotateNodesByLabel",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1],s=this.getNodeFromLabel(r);if(!s)throw new Error("tip with key ".concat(r," not found in tree"));this.annotateNode(s,o)}}},{key:"annotateNode",value:function(t,e){this.addAnnotations(e),t.annotations=Object(k.a)({},void 0===t.annotations?{}:t.annotations,e)}},{key:"addAnnotations",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1];if(!(o instanceof Date||"symbol"===typeof o)){var l=this.annotations[r];if(l||(l={},this.annotations[r]=l),("string"===typeof o||o instanceof String)&&(o=[o]),Array.isArray(o)){var u=D.DISCRETE;if(l.type&&l.type!==u)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=u,l.values=l.values?[].concat(Object(s.a)(l.values),Object(s.a)(o)):Object(s.a)(o)}else if(Object.isExtensible(o)){for(var h=null,d=0,g=[],f=0,v=Object.entries(o);f<v.length;f++){var p=v[f],b=Object(c.a)(p,2),y=b[0],m=b[1];if(g.includes(y))throw Error("the states of annotation, ".concat(y,", should be unique"));if("number"===typeof m){if((h=void 0===h?D.PROBABILITIES:h)===D.DISCRETE)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((d+=m)>1.01)throw Error("the values of annotation, ".concat(y,", should be probabilities of states and add to 1.0"))}else{if(typeof m!==typeof!0)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((h=void 0===h?D.DISCRETE:h)===D.PROBABILITIES)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"))}g.push(y)}if(l.type&&l.type!==h)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=h,l.values=l.values?[].concat(Object(s.a)(l.values),[o]):[o]}else{var O=D.DISCRETE;if(typeof o===typeof!0?O=D.BOOLEAN:isNaN(o)||(O=o%1===0?D.INTEGER:D.FLOAT),l.type&&l.type!==O){if(!(O===D.INTEGER&&l.type===D.FLOAT||O===D.FLOAT&&l.type===D.INTEGER))throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));O=D.FLOAT}O===D.DISCRETE&&(l.values||(l.values=new Set),l.values.add(o)),l.type=O}this.annotations[r]=l}}}},{key:"annotateNodesFromTips",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function t(e,n){if(!n.children)return n.annotations[e]?Array.isArray(n.annotations[e])?n.annotations[e]:[n.annotations[e]]:[];var a;var i=[];n.children.forEach(function(n){var r=t(e,n);i=[].concat(Object(s.a)(i),Object(s.a)(r.filter(function(t){return!i.includes(t)}))),a=void 0===a?r:r.filter(function(t){return a.includes(t)})});n.annotations=void 0===n.annotations?{}:n.annotations;n.annotations[e]=Object(s.a)(a.length>0?a:i);return n.annotations[e]}(t,this.rootNode),function t(e,n,a,i){var r=i.annotations[e];Array.isArray(r)||(r=[r]);if(i.children){var o={};r.forEach(function(t){return o[t]=o[t]?o[t]+=1:1}),n.forEach(function(t){return o[t]=o[t]?o[t]+=1:1}),i.children.forEach(function(n){t(e,r,a,n).forEach(function(t){return o[t]=o[t]?o[t]+=1:1})});var s=Object.entries(o).reduce(function(t,e){return t[1]>e[1]?t:e})[1];r=Object.entries(o).filter(function(t){var e=Object(c.a)(t,2),n=(e[0],e[1]);return n===s}).map(function(t){var e=Object(c.a)(t,2),n=e[0];e[1];return n}),i.annotations[e]=1===r.length?r[0]:r}return r}(t,[],e,this.rootNode)}},{key:"rootNode",get:function(){return this.root}},{key:"nodes",get:function(){return Object(s.a)(this.nodeList)}},{key:"externalNodes",get:function(){return this.nodes.filter(function(t){return!t.children})}},{key:"internalNodes",get:function(){return this.nodes.filter(function(t){return t.children})}}],[{key:"pathToRoot",value:R.a.mark(function t(e){return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,e;case 3:e=e.parent,t.next=0;break;case 6:case"end":return t.stop()}},t)})},{key:"parseNewick",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e.split(/\s*('[^']+'|"[^"]+"|;|\(|\)|,|:)\s*/),r=0,o=null,s=[],c=!1,l=!1,u=!0,h=!1,d=void 0;try{for(var g,f=i.filter(function(t){return t.length>0})[Symbol.iterator]();!(u=(g=f.next()).done);u=!0){var v=g.value;if("("===v){if(c)throw new Error("expecting a comma");var p={level:r,parent:o,children:[],annotations:{}};r+=1,o&&s.push(o),o=p}else if(","===v){if(c=!1,l)throw new Error("branch length missing");var b=s.pop();b.children.push(o),o=b}else if(")"===v){if(c=!1,l)throw new Error("branch length missing");var y=s.pop();y.children.push(o),r-=1,o=y,c=!0}else if(":"===v)c=!1,l=!0;else{if(";"===v){if(r>0)throw new Error("unexpected semi-colon in tree");break}if(l)o.length=parseFloat(v),l=!1;else if(c){if(o.label=v,o.label.startsWith("#"))o.id=o.label.substring(1);else{var m=parseFloat(o.label);isNaN(m)&&(m=o.label),o.annotations[n]=m}c=!1}else{o.children||(o.children=[]);var O=v;(O.startsWith('"')||O.startsWith("'"))&&(O=O.substr(1)),(O.endsWith('"')||O.endsWith("'"))&&(O=O.substr(0,O.length-1)),O=O.trim();var x=void 0;if(a){var j=O.split(a);if(0===j.length)throw new Error("the tip, ".concat(O,", doesn't have a date separated by the prefix, '").concat(a,"'"));x=parseFloat(j[j.length-1])}var k={name:O,date:x,parent:o,annotations:{}};o&&s.push(o),o=k}}}}catch(E){h=!0,d=E}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}if(r>0)throw new Error("the brackets in the newick file are not balanced");return new t(o)}}]),t}();var I=n(7),z=function(){function t(e,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(u.a)(this,t),this.layout=n,this.margins=a,this.settings=Object(k.a)({},t.DEFAULT_SETTINGS(),i),this.svg=e}return Object(h.a)(t,null,[{key:"DEFAULT_SETTINGS",value:function(){return{tranitionDuration:0,xScaleType:p.a,yScaleType:p.a,yAxisType:T.b,xAxisType:T.a}}}]),Object(h.a)(t,[{key:"draw",value:function(){var t,e,n=this;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,Object(N.f)(this.svg).select("g").remove(),Object(N.f)(this.svg).append("g").attr("transform","translate(".concat(this.margins.left,",").concat(this.margins.top,")")),this.svgSelection=Object(N.f)(this.svg).select("g"),this.svgSelection.append("g").attr("class","axes-layer"),this.addDataLayers();var a=this.settings.xScaleType().domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),i=this.settings.yScaleType().domain(this.layout.verticalRange).range([e-this.margins.bottom-this.margins.top,this.margins.top]);this.scales={x:a,y:i,width:t,height:e},this.addAxis(),this.layout.updateCallback=function(){n.update()},this.update()}},{key:"addDataLayers",value:function(){}},{key:"update",value:function(){}},{key:"onHover",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.svgSelection.selectAll("".concat(e));n.on("mouseover",function(e,n,a){t.enter(e,n,a)}),n.on("mouseout",function(e,n,a){t.exit(e,n,a)})}},{key:"onClick",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.svgSelection.selectAll("".concat(e)).on("click",function(e,n,a){t(e,n,a)})}},{key:"addToolTip",value:function(t,e){this.svgSelection.selectAll(t).on("mouseover",function(t,n,a){var i=document.getElementById("tooltip");i.innerHTML=e(t,n,a),i.style.display="block",i.style.left=I.e.pageX+10+"px",i.style.top=I.e.pageY+10+"px",i.style.visibility="visible"}),this.svgSelection.selectAll(t).on("mouseout",function(){document.getElementById("tooltip").style.visibility="hidden"})}},{key:"addAxis",value:function(){var t=this.svgSelection.select(".axes-layer");this.settings.xAxisType&&t.append("g").attr("class","x axis").attr("id","x-axis").attr("transform","translate(0, ".concat(this.scales.height-this.margins.bottom+5,")")).call(Object(T.a)(this.scales.x).tickValues(this.layout.horizontalAxisTicks)),this.settings.yAxisType&&t.append("g").attr("class","y axis").attr("id","y-axis").attr("transform","translate(".concat(this.margins.left/2,",0)")).call(Object(T.b)(this.scales.y).ticks(5))}},{key:"updateAxis",value:function(){this.svgSelection.select("#x-axis").call(Object(T.a)(this.scales.x).tickValues(this.layout.horizontalAxisTicks)).attr("transform","translate(0, ".concat(this.scales.height-this.margins.bottom+5,")")).transition().duration(this.settings.transitionDuration).ease(A.b),this.svgSelection.select("#y-axis").attr("transform","translate(".concat(this.margins.left/2,",0)")).call(Object(T.b)(this.scales.y).ticks(5)).transition().duration(this.settings.transitionDuration).ease(A.b)}},{key:"updateAxisBars",value:function(){for(var t=this,e=this.svgSelection.select(".axes-layer"),n=[],a=0;a<this.layout.horizontalAxisTicks.length-1;a++)n.push({x0:this.layout.horizontalAxisTicks[a],x1:this.layout.horizontalAxisTicks[a+1]});var i=e.selectAll(".axis-box").data(n);i.enter().append("rect").attr("x",function(e){return t.scales.x(e.x0)}).attr("width",function(e){return t.scales.x(e.x1)-t.scales.x(e.x0)}).attr("y",function(t){return 0}).attr("height",function(e){return t.scales.height-t.margins.bottom-t.margins.top}).attr("class",function(t,e){return e%2===0?"axis-box even":"axis-box odd"});i.transition().duration(this.settings.transitionDuration).attr("x",function(e){return t.scales.x(e.x0)}).attr("width",function(e){return t.scales.x(e.x1)-t.scales.x(e.x0)}).attr("y",function(t){return 0}).attr("height",function(e){return t.scales.height-t.margins.bottom-t.margins.top}).attr("class",function(t,e){return e%2===0?"axis-box even":"axis-box odd"}),i.exit().remove()}},{key:"getAnnotations",value:function(t){var e=this;return Object(s.a)(Object.entries(t).filter(function(t){var n=Object(c.a)(t,1)[0];return!!e.layout.annotations[n]&&(e.layout.annotations[n].type===D.DISCRETE||e.layout.annotations[n].type===D.BOOLEAN||e.layout.annotations[n].type===D.INTEGER)}).map(function(t){var e=Object(c.a)(t,2),n=e[0],a=e[1];return"".concat(n,"-").concat(a)}))}}]),t}(),M=function(t){function e(t,n,a){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(u.a)(this,e),(i=Object(E.a)(this,Object(w.a)(e).call(this))).layout=n,i.margins=a,i.settings=Object(k.a)({},z.DEFAULT_SETTINGS(),e.DEFAULT_SETTINGS(),r),i.svg=t,i}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{hoverBorder:2,backgroundBorder:0,baubles:[],transitionDuration:0}}}]),Object(h.a)(e,[{key:"addDataLayers",value:function(){this.settings.backgroundBorder>0&&this.svgSelection.append("g").attr("class","rect-background-layer"),this.svgSelection.append("g").attr("class","rect-layer")}},{key:"update",value:function(){var t,e;this.bins=[],this.layout.layout(this.bins),t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,this.scales.x.domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),this.scales.y.domain(this.layout.verticalRange).range([e-this.margins.bottom-this.margins.top,this.margins.top]),this.scales.width=t,this.scales.height=e,this.settings.backgroundBorder>0&&function(){var t=this,e=this.svgSelection.select(".rect-background-layer").selectAll(".rect-background").data(this.bins,function(t){return"cb_".concat(t.data.id)});e.enter().append("rect").attr("id",function(t){return t.id}).attr("class",function(e){return["rect-background"].concat(Object(s.a)(t.getAnnotations(e.data))).join(" ")}).attr("x",function(e){return t.scales.x(e.x0)+1}).attr("width",function(e){return Math.max(0,t.scales.x(e.x1)-t.scales.x(e.x0)-1)}).attr("y",function(e){return t.scales.y(e.y1)}).attr("height",function(e){return t.scales.y(e.y0)-t.scales.y(e.y1)});e.transition().duration(this.settings.transitionDuration).attr("x",function(e){return t.scales.x(e.x0)+1}).attr("width",function(e){return Math.max(0,t.scales.x(e.x1)-t.scales.x(e.x0)-1)}).attr("y",function(e){return t.scales.y(e.y1)}).attr("height",function(e){return t.scales.y(e.y0)-t.scales.y(e.y1)}),e.exit().remove()}.call(this),function(){var t=this,e=Object(N.f)(this.svg).select(".rect-layer").selectAll(".rect").data(this.bins,function(t){return"c_".concat(t.data.id)});e.enter().append("rect").attr("id",function(t){return t.id}).attr("class",function(e){return["rect"].concat(Object(s.a)(t.getAnnotations(e.data))).join(" ")}).attr("x",function(e){return t.scales.x(e.x0)+1}).attr("width",function(e){return Math.max(0,t.scales.x(e.x1)-t.scales.x(e.x0)-1)}).attr("y",function(e){return t.scales.y(e.y1)}).attr("height",function(e){return t.scales.y(e.y0)-t.scales.y(e.y1)});e.transition().duration(this.settings.transitionDuration).attr("x",function(e){return t.scales.x(e.x0)+1}).attr("width",function(e){return Math.max(0,t.scales.x(e.x1)-t.scales.x(e.x0)-1)}).attr("y",function(e){return t.scales.y(e.y1)}).attr("height",function(e){return t.scales.y(e.y0)-t.scales.y(e.y1)}),e.exit().remove()}.call(this),this.updateAxis()}}]),e}(z);n(22);var B=function(){function t(){Object(u.a)(this,t),this._horizontalRange=[0,1],this._verticalRange=[0,1],this._horizontalTicks=[0,.5,1],this.updateCallback=function(){}}return Object(h.a)(t,[{key:"layout",value:function(t,e){}},{key:"update",value:function(){this.updateCallback()}},{key:"rotate",value:function(){var t=this;return function(e){t.tree.rotate(e.node),t.update()}}},{key:"orderIncreasing",value:function(){var t=this;return function(e){t.tree.rotate(e.node),t.update()}}},{key:"orderDecreasing",value:function(){var t=this;return function(e){t.tree.rotate(e.node),t.update()}}},{key:"reroot",value:function(){var t=this;return function(e,n){t.tree.reroot(e.v1.node,n),t.update()}}},{key:"horizontalRange",get:function(){return this._horizontalRange}},{key:"verticalRange",get:function(){return this._verticalRange}},{key:"horizontalAxisTicks",get:function(){return this._horizontalTicks}}],[{key:"nodeInfo",value:function(t){var e="".concat(t.name?t.name:t.id);return Object.entries(t.annotations).forEach(function(t){var n=Object(c.a)(t,2),a=n[0],i=n[1];e+="<p>".concat(a,": ").concat(i,"</p>")}),e}}]),t}(),F=function(t){function e(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,e),(n=Object(E.a)(this,Object(w.a)(e).call(this))).tree=t,n.settings=Object(k.a)({},e.DEFAULT_SETTINGS(),a),n.branchLabelAnnotationName=null,n.internalNodeLabelAnnotationName=null,n.externalNodeLabelAnnotationName=null,n.tree.treeUpdateCallback=function(){n.update()},n}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{lengthFormat:Object(I.f)(".2f"),branchCurve:I.d,horizontalScale:null}}}]),Object(h.a)(e,[{key:"layout",value:function(t,e){var n=this;this._horizontalRange=[0,1],this._verticalRange=[0,this.tree.externalNodes.length-1],this.settings.horizontalScale?this.horizontalScale=this.settings.horizontalScale:this.horizontalScale=Object(I.l)().domain([0,Object(I.h)(Object(s.a)(this.tree.rootToTipLengths()))]).range(this._horizontalRange);var a=Object(s.a)(this.tree.postorder()),i=-1;0===t.length&&(this.nodeMap=new Map,a.forEach(function(e,a){var i={node:e,key:e.id};t.push(i),n.nodeMap.set(e,i)})),a.forEach(function(t){var e=n.nodeMap.get(t);e.x=n.horizontalScale(n.tree.rootToTipLength(e.node)),i=n.setYPosition(e,i),e.degree=e.node.children?e.node.children.length+1:1,e.id=t.id,e.classes=[e.node.children?"internal-node":"external-node",e.node.isSelected?"selected":"unselected"],e.node.annotations&&(e.classes=[].concat(Object(s.a)(e.classes),Object(s.a)(Object.entries(e.node.annotations).filter(function(t){var e=Object(c.a)(t,1)[0];return n.tree.annotations[e]&&(n.tree.annotations[e].type===D.DISCRETE||n.tree.annotations[e].type===D.BOOLEAN||n.tree.annotations[e].type===D.INTEGER)}).map(function(t){var e=Object(c.a)(t,2),n=e[0],a=e[1];return"".concat(n,"-").concat(a)})))),e.node.children?(e.leftLabel=n.internalNodeLabelAnnotationName?e.node.annotations[n.internalNodeLabelAnnotationName]:"",e.rightLabel="",e.labelBelow=!e.node.parent||e.node.parent.children[0]!==e.node):(e.leftLabel="",e.rightLabel=n.externalNodeLabelAnnotationName?e.node.annotations[n.externalNodeLabelAnnotationName]:e.node.name),n.nodeMap.set(e.node,e)}),0===e.length&&(this.edgeMap=new Map,a.filter(function(t){return t.parent}).forEach(function(t,a){var i={v0:n.nodeMap.get(t.parent),v1:n.nodeMap.get(t),key:t.id};e.push(i),n.edgeMap.set(i,i.v1)})),e.forEach(function(t){t.v1=n.edgeMap.get(t),t.v0=n.nodeMap.get(t.v1.node.parent),t.classes=[];var e=[];!function t(e,n){if(e.children){var a=!0,i=!1,r=void 0;try{for(var o,s=e.children[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;t(c,n)}}catch(l){i=!0,r=l}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}else n.push(e.name)}(t.v1.node,e),t.v1.node.annotations&&(t.classes=[].concat(Object(s.a)(t.classes),Object(s.a)(e.map(function(t){return"tip-".concat(t)})),Object(s.a)(Object.entries(t.v1.node.annotations).filter(function(t){var e=Object(c.a)(t,1)[0];return n.tree.annotations[e]&&(n.tree.annotations[e].type===D.DISCRETE||n.tree.annotations[e].type===D.BOOLEAN||n.tree.annotations[e].type===D.INTEGER)}).map(function(t){var e=Object(c.a)(t,2),n=e[0],a=e[1];return"".concat(n,"-").concat(a)}))));var a=t.v1.x-t.v0.x;t.length=a,t.label=n.branchLabelAnnotationName?"length"===n.branchLabelAnnotationName?n.settings.lengthFormat(a):t.v1.node.annotations[n.branchLabelAnnotationName]:null,t.labelBelow=t.v1.node.parent.children[0]!==t.v1.node})}},{key:"setInternalNodeLabels",value:function(t){this.internalNodeLabelAnnotationName=t,this.update()}},{key:"setExternalNodeLabels",value:function(t){this.externalNodeLabelAnnotationName=t,this.update()}},{key:"setBranchLabels",value:function(t){this.branchLabelAnnotationName=t,this.update()}},{key:"update",value:function(){this.updateCallback()}},{key:"setYPosition",value:function(t,e){var n=this;return t.y=t.node.children?Object(I.i)(t.node.children,function(t){return n.nodeMap.get(t).y}):e+=1,e}},{key:"branchPathGenerator",value:function(t){var e=this;return function(n,a){return Object(I.g)().x(function(t){return t.x}).y(function(t){return t.y}).curve(e.branchCurve)([{x:0,y:t.y(n.v0.y)-t.y(n.v1.y)},{x:t.x(n.v1.x)-t.x(n.v0.x),y:0}])}}},{key:"branchCurve",set:function(t){this.settings.branchCurve=t,this.update()},get:function(){return this.settings.branchCurve}}]),e}(B);Symbol("UP"),Symbol("DOWN");var _=n(40),G=function(t){function e(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,e),(n=Object(E.a)(this,Object(w.a)(e).call(this))).graph=t,n.annotations={},n.settings=Object(k.a)({},e.DEFAULT_SETTINGS(),a),n.branchLabelAnnotationName=null,n.internalNodeLabelAnnotationName=null,n.externalNodeLabelAnnotationName=null,n}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{lengthFormat:Object(I.f)(".2f"),edgeWidth:2,xFunction:function(t,e,n){return e/n.length},branchCurve:I.c,curve:"arc",opacity:function(t){return 1}}}}]),Object(h.a)(e,[{key:"layout",value:function(t,e){var n=this;this._horizontalRange=[0,1],this._verticalRange=[-this.graph.nodes.length,this.graph.nodes.length];var a=Object(s.a)(this.graph.nodes);a.forEach(function(t){return n.addAnnotations(t)}),0===t.length&&(this.nodeMap=new Map,a.forEach(function(e,a){var i={node:e,key:e.id};t.push(i),n.nodeMap.set(e,i)}));var i=a.reduce(function(t,e){return-1===t.indexOf(e.location)&&t.push(e.location),t},[]);if(a.forEach(function(t,e){var a=n.nodeMap.get(t);a.x=n.settings.xFunction(t,e),a.y=10*i.indexOf(a.node.location)-10*i.length/2,a.degree=n.graph.getEdges(a.node).length,a.classes=[!n.graph.getOutgoingEdges(a.node).length>0?"external-node":"internal-node",a.node.isSelected?"selected":"unselected"],a.classes=[].concat(Object(s.a)(a.classes),Object(s.a)(n.getAnnotations(a.node))),n.nodeMap.set(a.node,a)}),0===e.length){this.edgeMap=new Map;var r=this.graph.edges;r.forEach(function(t){n.addAnnotations(t.metaData),n.addAnnotations({source:t.source.id,target:t.target.id})}),r.forEach(function(t,a){var i={v0:n.nodeMap.get(t.source),v1:n.nodeMap.get(t.target),key:t.id,data:t};e.push(i),n.edgeMap.set(i,i.v1)})}e.forEach(function(t){t.v1=n.edgeMap.get(t),t.v0=n.nodeMap.get(t.v0.node),t.classes=[];var e=t.v1.node,a=(e.id,Object(_.a)(e,["id"]));t.classes=[].concat(Object(s.a)(t.classes),Object(s.a)(n.getAnnotations(a)),Object(s.a)(n.getAnnotations(t.data.metaData)),Object(s.a)(n.getAnnotations({source:t.data.source.id,target:t.data.target.id})));var i=t.v1.x-t.v0.x;t.length=i,t.label=n.branchLabelAnnotationName?"length"===n.branchLabelAnnotationName?n.settings.lengthFormat(i):t.v1.node.annotations[n.branchLabelAnnotationName]:null})}},{key:"setInternalNodeLabels",value:function(t){this.internalNodeLabelAnnotationName=t,this.update()}},{key:"setExternalNodeLabels",value:function(t){this.externalNodeLabelAnnotationName=t,this.update()}},{key:"setBranchLabels",value:function(t){this.branchLabelAnnotationName=t,this.update()}},{key:"update",value:function(){this.updateCallback()}},{key:"addAnnotations",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1];if(!(o instanceof Date||"symbol"===typeof o||null===o)){var l=this.annotations[r];if(l||(l={},this.annotations[r]=l),("string"===typeof o||o instanceof String)&&(o=[o]),Array.isArray(o)){var u=D.DISCRETE;if(l.type&&l.type!==u)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=u,l.values=l.values?[].concat(Object(s.a)(l.values),Object(s.a)(o)):Object(s.a)(o)}else if(Object.isExtensible(o)){for(var h=null,d=0,g=[],f=0,v=Object.entries(o);f<v.length;f++){var p=v[f],b=Object(c.a)(p,2),y=b[0],m=b[1];if(g.includes(y))throw Error("the states of annotation, ".concat(y,", should be unique"));if("number"===typeof m){if((h=void 0===h?D.PROBABILITIES:h)===D.DISCRETE)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((d+=m)>1)throw Error("the values of annotation, ".concat(y,", should be probabilities of states and add to 1.0"))}else{if(typeof m!==typeof!0)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((h=void 0===h?D.DISCRETE:h)===D.PROBABILITIES)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"))}g.append(y)}if(l.type&&l.type!==h)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=h,l.values=l.values?[].concat(Object(s.a)(l.values),Object(s.a)(o)):Object(s.a)(o)}else{var O=D.DISCRETE;if(typeof o===typeof!0?O=D.BOOLEAN:Number(o)&&(O=o%1===0?D.INTEGER:D.FLOAT),l.type&&l.type!==O){if(!(O===D.INTEGER&&l.type===D.FLOAT||O===D.FLOAT&&l.type===D.INTEGER))throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));O=D.FLOAT}O===D.DISCRETE&&(l.values||(l.values=new Set),l.values.add(o)),l.type=O}this.annotations[r]=l}}}},{key:"getAnnotations",value:function(t){var e=this;return Object(s.a)(Object.entries(t).filter(function(t){var n=Object(c.a)(t,1)[0];return!!e.annotations[n]&&(e.annotations[n].type===D.DISCRETE||e.annotations[n].type===D.BOOLEAN||e.annotations[n].type===D.INTEGER)}).map(function(t){var e=Object(c.a)(t,2),n=e[0],a=e[1];return"".concat(n,"-").concat(a)}))}},{key:"branchPathGenerator",value:function(t){var e=this;return function(n,a){var i;if("bezier"===e.settings.curve){var r=a%2===0?1:-1,o={x:0,y:t.y(n.v0.y)-t.y(n.v1.y)},s={x:t.x(n.v1.x)-t.x(n.v0.x),y:0},c=Math.abs(o.x-s.x)/(t.x.range()[1]-t.x.range()[0]);t.y(t.y.domain()[1]),i=function(t,e,n,a){for(var i=[],r=0;r<=1;r+=.01){var o=Math.pow(1-r,3)*t.x+3*Math.pow(1-r,2)*r*e.x+3*(1-r)*Math.pow(r,2)*n.x+Math.pow(r,3)*a.x,s=Math.pow(1-r,3)*t.y+3*Math.pow(1-r,2)*r*e.y+3*(1-r)*Math.pow(r,2)*n.y+Math.pow(r,3)*a.y;i.push({x:o,y:s})}return i}(o,{x:o.x,y:r*t.y(t.y.domain()[1])*c},{x:s.x,y:r*t.y(t.y.domain()[1])*c},s)}else{var l=(t.x(n.v1.x)-t.x(n.v0.x))/2,u=l,h=a%2===0?1:-1,d=Object(I.k)(0,t.x(n.v1.x)-t.x(n.v0.x),1),g=d.map(function(t){return function(t,e,n,a){return a*Math.sqrt(Math.pow(e,2)-Math.pow(t-n,2))}(t,l,u,h)});i=d.map(function(t,e){return{x:t,y:g[e]}})}return Object(I.g)().x(function(t){return t.x}).y(function(t){return t.y}).curve(e.branchCurve)(i)}}},{key:"branchCurve",set:function(t){this.settings.branchCurve=t,this.update()},get:function(){return this.settings.branchCurve}}]),e}(B);var U=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,t),this.settings=Object(k.a)({},t.DEFAULT_SETTINGS(),e)}return Object(h.a)(t,null,[{key:"DEFAULT_SETTINGS",value:function(){return{vertexFilter:function(){return!0}}}}]),Object(h.a)(t,[{key:"createShapes",value:function(t){throw new Error("don't call the base class methods")}},{key:"updateShapes",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("don't call the base class methods")}},{key:"vertexFilter",get:function(){return this.settings.vertexFilter}}]),t}(),P=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(u.a)(this,e),Object(E.a)(this,Object(w.a)(e).call(this,Object(k.a)({},e.DEFAULT_SETTINGS(),t)))}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{radius:6}}}]),Object(h.a)(e,[{key:"createShapes",value:function(t){return t.append("circle")}},{key:"updateShapes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.attr("cx",0).attr("cy",0).attr("r",this.settings.radius+e)}}]),e}(U),H=function(t){function e(t,n,a){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(u.a)(this,e),(i=Object(E.a)(this,Object(w.a)(e).call(this))).layout=n,i.margins=a,i.settings=Object(k.a)({},e.DEFAULT_SETTINGS(),r),i.svg=t,i.updateStyles=[],i}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{xAxisTickArguments:[5,"f"],xAxisTitle:"Divergence",hoverBorder:2,backgroundBorder:0,baubles:[],transitionDuration:0,opacityFunc:function(t){return 1}}}}]),Object(h.a)(e,[{key:"draw",value:function(){var t,e,n=this;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,Object(I.m)(this.svg).select("g").remove(),Object(I.m)(this.svg).append("g").attr("transform","translate(".concat(this.margins.left,",").concat(this.margins.top,")")),this.svgSelection=Object(I.m)(this.svg).select("g"),this.svgSelection.append("g").attr("class","axes-layer"),this.svgSelection.append("g").attr("class","branches-layer"),this.settings.backgroundBorder>0&&this.svgSelection.append("g").attr("class","nodes-background-layer"),this.svgSelection.append("g").attr("class","nodes-layer");var a=Object(I.l)().domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right]),i=Object(I.l)().domain(this.layout.verticalRange).range([this.margins.top+20,e-this.margins.bottom-20]);this.scales={x:a,y:i,width:t,height:e},function(){var t=Object(I.a)(this.scales.x).tickArguments(this.settings.xAxisTickArguments),e=this.scales.width-this.margins.left-this.margins.right,n=this.svgSelection.select(".axes-layer");n.append("g").attr("id","x-axis").attr("class","axis").attr("transform","translate(0, ".concat(this.scales.height-this.margins.bottom+5,")")).call(t),n.append("g").attr("id","x-axis-label").attr("class","axis-label").attr("transform","translate(".concat(this.margins.left,", ").concat(this.scales.height-this.margins.bottom,")")).append("text").attr("transform","translate(".concat(e/2,", 35)")).attr("alignment-baseline","hanging").style("text-anchor","middle").text(this.settings.xAxisTitle)}.call(this,this.margins),this.vertices=[],this.edges=[],this.layout.updateCallback=function(){n.update()},this.update()}},{key:"update",value:function(){var t,e;this.layout.layout(this.vertices,this.edges),t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,this.scales.x.domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right]),this.scales.y.domain(this.layout.verticalRange).range([this.margins.top+20,e-this.margins.bottom-20]),this.scales.width=t,this.scales.height=e;var n=Object(I.a)(this.scales.x).tickArguments(this.settings.xAxisTickArguments);this.svgSelection.select("#x-axis").transition().duration(this.settings.transitionDuration).call(n),this.settings.backgroundBorder>0&&function(){var t=this,e=this.svgSelection.select(".nodes-background-layer").selectAll(".node-background").data(this.vertices,function(t){return"nb_".concat(t.key)}),n=e.enter();this.settings.baubles.forEach(function(e){var a=e.createShapes(n.filter(e.vertexFilter)).attr("class",function(t){return["node-background"].concat(Object(s.a)(t.classes)).join(" ")}).attr("transform",function(e){return"translate(".concat(t.scales.x(e.x),", ").concat(t.scales.y(e.y),")")});e.updateShapes(a,t.settings.backgroundBorder)}),this.settings.baubles.forEach(function(n){var a=e.filter(n.vertexFilter).transition().duration(t.settings.transitionDuration).attr("transform",function(e){return"translate(".concat(t.scales.x(e.x),", ").concat(t.scales.y(e.y),")")});n.updateShapes(a,t.settings.backgroundBorder)}),e.exit().remove()}.call(this),function(){var t=this,e=Object(I.m)(this.svg).select(".nodes-layer").selectAll(".node").data(this.vertices,function(t){return"n_".concat(t.key)}),n=e.enter().append("g").attr("id",function(t){return t.id}).attr("class",function(t){return["node"].concat(Object(s.a)(t.classes)).join(" ")}).attr("transform",function(e){return"translate(".concat(t.scales.x(e.x),", ").concat(t.scales.y(e.y),")")});this.settings.baubles.forEach(function(t){var e=t.createShapes(n.filter(t.vertexFilter)).attr("class","node-shape");t.updateShapes(e)}),e.transition().duration(this.settings.transitionDuration).attr("class",function(t){return["node"].concat(Object(s.a)(t.classes)).join(" ")}).attr("transform",function(e){return"translate(".concat(t.scales.x(e.x),", ").concat(t.scales.y(e.y),")")}),this.settings.baubles.forEach(function(n){var a=e.select(".node-shape").filter(n.vertexFilter).transition().duration(t.settings.transitionDuration);n.updateShapes(a)}),e.exit().remove()}.call(this),Y.call(this),Y.call(this)}},{key:"hilightBranches",value:function(){var t=this,e=this.svgSelection.selectAll(".branch").select(".branch-path");e.on("mouseover",function(e,n,a){Object(I.m)(this).classed("hovered",!0),console.log(t)}),e.on("mouseout",function(t,e){Object(I.m)(this).classed("hovered",!1)})}},{key:"hilightInternalNodes",value:function(){this.hilightNodes(".internal-node")}},{key:"hilightExternalNodes",value:function(){this.hilightNodes(".external-node")}},{key:"hilightNodes",value:function(t){var e=this,n=this.svgSelection.selectAll(t);n.on("mouseover",function(t,n){var a=Object(I.m)(this).select(".node-shape");e.settings.baubles.forEach(function(t){t.vertexFilter(a)&&t.updateShapes(a,e.settings.hoverBorder)}),a.classed("hovered",!0)}),n.on("mouseout",function(t,n){var a=Object(I.m)(this).select(".node-shape");e.settings.baubles.forEach(function(t){t.vertexFilter(a)&&t.updateShapes(a,0)}),a.classed("hovered",!1)})}},{key:"onClickBranch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this;this.svgSelection.selectAll("".concat(e||".branch")).on("click",function(e){var a=n.scales.x(e.v1.x),i=n.scales.x(e.v0.x),r=Object(I.j)(this)[0],o=Math.max(0,Math.min(1,(r-i)/(a-i)));t(e,o)})}},{key:"onClickInternalNode",value:function(t){this.onClickNode(t,".internal-node")}},{key:"onClickExternalNode",value:function(t){this.onClickNode(t,".external-node")}},{key:"onClickNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.svgSelection.selectAll("".concat(e||".node")).select(".node-shape"),a=this;n.on("click",function(e,n,i){t(e,n,i,a)})}},{key:"onHoverNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this,a=this.svgSelection.selectAll("".concat(e||".node")).select(".node-shape");a.on("mouseover",function(e,a,i){t.enter(e,a,i,n)}),a.on("mouseout",function(e,a,i){t.exit(e,a,i,n)})}},{key:"onHoverBranch",value:function(t){var e=this,n=this.svgSelection.selectAll(".branch").select(".branch-path");n.on("mouseover",function(n,a,i){t.enter(n,a,i,e)}),n.on("mouseout",function(n,a,i){t.exit(n,a,i,e)})}},{key:"addToolTip",value:function(t,e){this.svgSelection.selectAll(t).on("mouseover",function(t){var n=document.getElementById("tooltip");n.innerHTML="string"===typeof e?e:e(t.node),n.style.display="block",n.style.left=I.e.pageX+10+"px",n.style.top=I.e.pageY+10+"px"}),this.svgSelection.selectAll(t).on("mouseout",function(){document.getElementById("tooltip").style.display="none"})}},{key:"highlightNode",value:function(t,e){var n=this,a=this.svgSelection.select(".node.id-".concat(t)),i=a.select(".node-shape");a.raise(),this.settings.baubles.forEach(function(t){t.vertexFilter(i)&&t.updateShapes(i,n.settings.hoverBorder)}),i.classed(e,!0)}},{key:"unHighlightNode",value:function(t,e){var n=this.svgSelection.select(".node.id-".concat(t)),a=n.select(".node-shape");n.raise(),this.settings.baubles.forEach(function(t){t.vertexFilter(a)&&t.updateShapes(a,0)}),a.classed(e,!1)}},{key:"treeLayout",set:function(t){this.layout=t,this.update()}}]),e}(z);function Y(){var t=this,e=this.svgSelection.select(".branches-layer"),n=this.layout.branchPathGenerator(this.scales),a=e.selectAll("g .branch").data(this.edges,function(t){return"b_".concat(t.key)}),i=a.enter().append("g").attr("id",function(t){return t.id}).attr("opacity",function(e){return t.settings.opacityFunc(e)}).attr("class",function(t){return["branch"].concat(Object(s.a)(t.classes)).join(" ")}).attr("transform",function(e){return"translate(".concat(t.scales.x(e.v0.x),", ").concat(t.scales.y(e.v1.y),")")});i.append("path").attr("class","branch-path").attr("d",function(t,e){n(t,e)}),i.append("text").attr("class","branch-label length").attr("dx",function(e){return(t.scales.x(e.v1.x)-t.scales.x(e.v0.x))/2}).attr("dy",function(t){return t.labelBelow?6:-6}).attr("alignment-baseline",function(t){return t.labelBelow?"hanging":"bottom"}).attr("text-anchor","middle").text(function(t){return t.label}),a.transition().duration(this.settings.transitionDuration).attr("class",function(t){return["branch"].concat(Object(s.a)(t.classes)).join(" ")}).attr("transform",function(e){return"translate(".concat(t.scales.x(e.v0.x),", ").concat(t.scales.y(e.v1.y),")")}).select("path").attr("d",function(t,e){return n(t,e)}).select("text .branch-label .length").attr("class","branch-label length").attr("dx",function(e){return(t.scales.x(e.v1.x)-t.scales.x(e.v0.x))/2}).attr("dy",function(t){return t.labelBelow?6:-6}).attr("alignment-baseline",function(t){return t.labelBelow?"hanging":"bottom"}).attr("text-anchor","middle").attr("opacity",function(e){return t.settings.opacityFunc(e)}).text(function(t){return t.label}),a.exit().remove()}var W=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{acyclicSelector:function(t){return!0}};Object(u.a)(this,t),this.nodeList=[],this.nodeMap=new Map,this.outGoingEdgeMap=new Map,this.incomingEdgeMap=new Map,this.edgeList=[],this.edgeMap=new Map,this.acyclicSelector=i.acyclicSelector,n.forEach(function(t){return e.addNode(t)}),a.forEach(function(t){var n=t.metaData?t.metaData:{};e.drawEdge(t.source,t.target,n)})}return Object(h.a)(t,[{key:"addNode",value:function(t){if(!t.id)throw new Error("All node's must contain an 'id' key ".concat(t));if(this.nodeList.push(t),this.nodeMap.has(t.id))throw new Error("All node's must have unique id values ".concat(t.id," seen twice"));this.nodeMap.set(t.id,t),this.outGoingEdgeMap.set(t,[]),this.incomingEdgeMap.set(t,[])}},{key:"getNode",value:function(t){return this.nodeMap.get(t)}},{key:"getIncomingEdges",value:function(t){return this.incomingEdgeMap.get(t)}},{key:"getOutgoingEdges",value:function(t){return this.outGoingEdgeMap.get(t)}},{key:"getEdges",value:function(t){return this.getOutgoingEdges(t).concat(this.getIncomingEdges(t))}},{key:"getNodeInfo",value:function(t){}},{key:"removeNode",value:function(t){var e=this;this.getEdges(t).forEach(function(t){return e.removeEdge(t)});var n=t.id;this.nodeList=this.nodeList.filter(function(t){return t.id!==n}),this.nodeMap.delete(n),this.incomingEdgeMap.delete(t),this.outGoingEdgeMap.delete(t)}},{key:"getEdge",value:function(t){return this.edgeMap.get(t)}},{key:"getEdgeInfo",value:function(t){}},{key:"drawEdge",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.nodeMap.has(t))throw new Error("".concat(t," not found in graph"));if(!this.nodeMap.has(e))throw new Error("".concat(e," not found in graph"));var a=this.edgeList.length,i={source:this.getNode(t),target:this.getNode(e),id:"edge_".concat(a),metaData:n};this.addEdge(i)}},{key:"addEdge",value:function(t){this.edgeList.push(t),this.edgeMap.set(t.id,t),this.outGoingEdgeMap.get(t.source).push(t),this.incomingEdgeMap.get(t.target).push(t)}},{key:"removeEdge",value:function(t){var e=t.id;this.edgeList=this.edgeList.filter(function(t){return t.id!==e}),this.edgeMap.delete(e);var n=this.getOutgoingEdges(t.source).filter(function(e){return e!==t});this.outGoingEdgeMap.set(t.source,n);var a=this.getIncomingEdges(t.target).filter(function(e){return e!==t});this.incomingEdgeMap.set(t.target,a)}},{key:"insertNode",value:function(t,e){this.nodeMap.has(t.id)||this.addNode(t),this.drawEdge(e.source.id,t.id),this.drawEdge(t.id,e.target.id),this.removeEdge(e)}},{key:"getSubGraph",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{key:"getPaths",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];throw new Error("Not yet implimented")}},{key:"rotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{recursive:!1},n=Object(s.a)(this.preorder(t)),a=this.getOutgoingEdges(t);if(e.recursive){var i=!0,r=!1,o=void 0;try{for(var c,l=n[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value;this.getOutgoingEdges(u).reverse()}}catch(h){r=!0,o=h}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}}else a.reverse()}},{key:"order",value:function(t,e){}},{key:"preorder",value:R.a.mark(function t(e){var n,a;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.edgeList.forEach(function(t){return t.visited=!1}),this.nodeList.forEach(function(t){return t.visited=!1}),n=this,a=R.a.mark(function t(e){var a,i,r,o,s,c,l,u;return R.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e;case 2:if(!((a=n.getEdges(e).filter(function(t){return n.acyclicSelector(t)})).length>0)){h.next=37;break}i=!0,r=!1,o=void 0,h.prev=7,s=a[Symbol.iterator]();case 9:if(i=(c=s.next()).done){h.next=23;break}if((l=c.value).visited){h.next=20;break}if(u=void 0,(u=e===l.source?l.target:l.source).visited){h.next=19;break}return l.visited=!0,h.delegateYield(t(u),"t0",17);case 17:h.next=20;break;case 19:l.visited=!0;case 20:i=!0,h.next=9;break;case 23:h.next=29;break;case 25:h.prev=25,h.t1=h.catch(7),r=!0,o=h.t1;case 29:h.prev=29,h.prev=30,i||null==s.return||s.return();case 32:if(h.prev=32,!r){h.next=35;break}throw o;case 35:return h.finish(32);case 36:return h.finish(29);case 37:case"end":return h.stop()}},t,null,[[7,25,29,37],[30,,32,36]])}),t.delegateYield(a(e),"t0",5);case 5:this.edgeList.forEach(function(t){return delete t.visited}),this.nodeList.forEach(function(t){return delete t.visited});case 7:case"end":return t.stop()}},t,this)})},{key:"postorder",value:R.a.mark(function t(e){var n,a;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.edgeList.forEach(function(t){return t.visited=!1}),this.nodeList.forEach(function(t){return t.visited=!1}),n=this,a=R.a.mark(function t(e){var a,i,r,o,s,c,l,u;return R.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!((a=n.getEdges(e).filter(function(t){return n.acyclicSelector(t)})).length>0)){h.next=35;break}i=!0,r=!1,o=void 0,h.prev=5,s=a[Symbol.iterator]();case 7:if(i=(c=s.next()).done){h.next=21;break}if((l=c.value).visited){h.next=18;break}if(u=void 0,(u=e===l.source?l.target:l.source).visited){h.next=17;break}return l.visited=!0,h.delegateYield(t(u),"t0",15);case 15:h.next=18;break;case 17:l.visited=!0;case 18:i=!0,h.next=7;break;case 21:h.next=27;break;case 23:h.prev=23,h.t1=h.catch(5),r=!0,o=h.t1;case 27:h.prev=27,h.prev=28,i||null==s.return||s.return();case 30:if(h.prev=30,!r){h.next=33;break}throw o;case 33:return h.finish(30);case 34:return h.finish(27);case 35:return h.next=37,e;case 37:case"end":return h.stop()}},t,null,[[5,23,27,35],[28,,30,34]])}),t.delegateYield(a(e),"t0",5);case 5:this.edgeList.forEach(function(t){return delete t.visited}),this.nodeList.forEach(function(t){return delete t.visited});case 7:case"end":return t.stop()}},t,this)})},{key:"nodes",get:function(){return this.nodeList}},{key:"externalNodes",get:function(){var t=this;return this.nodeList.filter(function(e){return 0===t.getOutgoingEdges().length})}},{key:"edges",get:function(){return this.edgeList}}],[{key:"fromPhylogeny",value:function(t){t.externalNodes}}]),t}();n(47);var X=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(u.a)(this,t),this.data=e,this.settings=Object(k.a)({},t.DEFAULT_SETTINGS(),n),this._horizontalRange=[0,1],this._verticalRange=[0,1],this._horizontalTicks=this.settings.horizontalScale().domain(this._horizontalRange).ticks(5),this.updateCallback=function(){},this.annotations={}}return Object(h.a)(t,null,[{key:"DEFAULT_SETTINGS",value:function(){return{horizontalRange:null,horizontalTicks:null,horizontalScale:p.a}}}]),Object(h.a)(t,[{key:"layout",value:function(t){}},{key:"update",value:function(){this.updateCallback()}},{key:"addAnnotations",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var a=n[e],i=Object(c.a)(a,2),r=i[0],o=i[1];if(!(o instanceof Date||"symbol"===typeof o||null===o)){var l=this.annotations[r];if(l||(l={},this.annotations[r]=l),("string"===typeof o||o instanceof String)&&(o=[o]),Array.isArray(o)){var u=D.DISCRETE;if(l.type&&l.type!==u)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=u,l.values=l.values?[].concat(Object(s.a)(l.values),Object(s.a)(o)):Object(s.a)(o)}else if(Object.isExtensible(o)){for(var h=null,d=0,g=[],f=0,v=Object.entries(o);f<v.length;f++){var p=v[f],b=Object(c.a)(p,2),y=b[0],m=b[1];if(g.includes(y))throw Error("the states of annotation, ".concat(y,", should be unique"));if("number"===typeof m){if((h=void 0===h?D.PROBABILITIES:h)===D.DISCRETE)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((d+=m)>1)throw Error("the values of annotation, ".concat(y,", should be probabilities of states and add to 1.0"))}else{if(typeof m!==typeof!0)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"));if((h=void 0===h?D.DISCRETE:h)===D.PROBABILITIES)throw Error("the values of annotation, ".concat(y,", should be all boolean or all floats"))}g.append(y)}if(l.type&&l.type!==h)throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));l.type=h,l.values=l.values?[].concat(Object(s.a)(l.values),Object(s.a)(o)):Object(s.a)(o)}else{var O=D.DISCRETE;if(typeof o===typeof!0?O=D.BOOLEAN:Number(o)&&(O=o%1===0?D.INTEGER:D.FLOAT),l.type&&l.type!==O){if(!(O===D.INTEGER&&l.type===D.FLOAT||O===D.FLOAT&&l.type===D.INTEGER))throw Error("existing values of the annotation, ".concat(r,", in the tree is not of the same type"));O=D.FLOAT}O===D.DISCRETE&&(l.values||(l.values=new Set),console.log(o),l.values.add(o)),l.type=O}this.annotations[r]=l}}}},{key:"horizontalRange",get:function(){return this._horizontalRange}},{key:"verticalRange",get:function(){return this._verticalRange}},{key:"horizontalAxisTicks",get:function(){return this._horizontalTicks}}]),t}(),q=function(t){function e(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(u.a)(this,e),(n=Object(E.a)(this,Object(w.a)(e).call(this))).settings=Object(k.a)({},e.DEFAULT_SETTINGS(),a),n.data=t,n._horizontalRange=[0,1],n._verticalRange=[1,0],n._horizontalTicks=n.settings.horizontalScale().domain(n._horizontalRange).ticks(5),n}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{groupingFunction:function(t){return 1},binnedFunction:function(t){return b.j.floor(t.symptomOnset)},keyToXFunction:{x0:function(t){return Object(b.j)(new Date(t.key))},x1:function(t){return b.j.offset(new Date(t.key),1)}},horizontalRange:null,horizontalTicks:null,horizontalScale:p.a,annotations:null}}}]),Object(h.a)(e,[{key:"layout",value:function(t){var e=this,n=Object(m.b)().key(function(t){return b.j.floor(t.symptomOnset)}).entries(this.data).map(function(t){return{x0:Object(b.j)(new Date(t.key)),x1:b.j.offset(new Date(t.key),1),values:t.values}}),a=this.data.map(function(t){return e.settings.groupingFunction(t)}).reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[]),i=0,r=0,o=!0,s=!1,c=void 0;try{for(var l,u=n[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;i=0;var d=!0,g=!1,f=void 0;try{for(var v,p=function(){var n=v.value,a=h.values.filter(function(t){return e.settings.groupingFunction(t)===n}),r={x0:h.x0,x1:h.x1,colorKey:n};if(a.length>0){var o=!0,s=!1,c=void 0;try{for(var l,u=a[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var d=l.value,g=Object(k.a)({},r,{data:d});e.addAnnotations(d),g.y0=i,g.y1=i+1,i+=1,t.push(g)}}catch(f){s=!0,c=f}finally{try{o||null==u.return||u.return()}finally{if(s)throw c}}}},O=a[Symbol.iterator]();!(d=(v=O.next()).done);d=!0)p()}catch(x){g=!0,f=x}finally{try{d||null==O.return||O.return()}finally{if(g)throw f}}r=Object(y.e)([r,i])}}catch(x){s=!0,c=x}finally{try{o||null==u.return||u.return()}finally{if(s)throw c}}this.settings.horizontalRange?this._horizontalRange=this.settings.horizontalRange:this._horizontalRange=[Object(y.h)(n,function(t){return t.x0}),Object(y.e)(n,function(t){return t.x1})],this.settings.horizontalTicks?this._horizontalTicks=this.settings.horizontalTicks:this._horizontalTicks=this.settings.horizontalScale().domain(this._horizontalRange).ticks(5),this._verticalRange=[0,r]}},{key:"update",value:function(){this.updateCallback()}},{key:"horizontalRange",get:function(){return this._horizontalRange}},{key:"verticalRange",get:function(){return this._verticalRange}},{key:"horizontalAxisTicks",get:function(){return this._horizontalTicks}}]),e}(X),V=Object(I.n)("%B %d, %Y"),J={enter:function(t,e,n){Object(N.f)(n[e]).classed("hovered",!0);var a=document.getElementById("tooltip");a.innerHTML="Case Id: ".concat(t.data.id,"\n                        <br/>\n                        Location: ").concat(t.data.location,"\n                        <br/>\n                        Symptom onset: ").concat(V(t.data.symptomOnset)," "),a.style.display="block",a.style.left=I.e.pageX+(I.e.pageX>800?-300:10)+"px",a.style.top=I.e.pageY+10+"px",a.style.visibility="visible"},exit:function(t,e,n){Object(N.f)(n[e]).classed("hovered",!1),document.getElementById("tooltip").style.visibility="hidden"}};var K=function(t){var e=Object(a.useState)(null),n=Object(c.a)(e,2),r=n[0],o=n[1],s=Object(a.useRef)();Object(a.useEffect)(function(){Object(N.f)(s.current).select("g").remove();var e=new M(s.current,t.layout,t.margins,{hoverBorder:4,backgroundBorder:0,tranitionDuration:0});e.draw(),e.onHover(J,".rect"),e.onClick(function(t,e,n){return alert("clicked ".concat(t.data.id))}),Object(N.f)(s.current).select(".axes-layer").select("#x-axis").remove(),o(e)},[t.data]);var l="b".concat(Math.random().toString(36).substring(4));return Object(a.useEffect)(function(){null!==r&&r.update()},[t.chartGeom,t.data]),i.a.createElement("svg",{className:"chart",id:l,ref:s,height:t.chartGeom.height,width:t.chartGeom.width})};var $=function(t){var e=Object(a.useState)(null),n=Object(c.a)(e,2),r=n[0],o=n[1],l=Object(a.useRef)();return Object(a.useEffect)(function(){var e=Object(p.b)().domain(Object(y.d)(t.dateRange)).range([0,1]),n=t.treeDateRange.map(function(t){return e(t)}),a=Object(p.a)().domain(Object(y.d)([0].concat(Object(s.a)(t.phylogeny.rootToTipLengths())))).range(n),i=new t.layout(t.phylogeny,{horizontalScale:a}),r=new H(l.current,i,t.margins,{hoverBorder:4,backgroundBorder:2,baubles:[new P],tranitionDuration:0});r.draw(),r.hilightInternalNodes(),r.hilightExternalNodes(),r.hilightBranches(),r.onClickNode(function(t){return console.log(t)}),Object(N.f)(l.current).select(".axes-layer").remove(),o(r)},[]),Object(a.useEffect)(function(){null!==r&&r.update()},[t.chartGeom,t.phylogeny]),"b".concat(Math.random().toString(36).substring(4)),i.a.createElement("svg",{className:"chart",id:"phylogeny",ref:l,height:t.chartGeom.height,width:t.chartGeom.width})},Q=function(){function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(u.a)(this,t),this.location=n,this.cases=a,this.id=e,this.children=[]}return Object(h.a)(t,[{key:"addCase",value:function(t){this.cases=[].concat(Object(s.a)(this.cases),[t])}},{key:"addChild",value:function(e){var n=this;e instanceof t?(this.children.push(e),e.parent=this):e instanceof Array&&e.forEach(function(t){return n.addChild(t)})}},{key:"preorder",value:R.a.mark(function t(){var e;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=R.a.mark(function t(e){var n,a,i,r,o,s;return R.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,e;case 2:if(!e.children){c.next=28;break}n=!0,a=!1,i=void 0,c.prev=6,r=e.children[Symbol.iterator]();case 8:if(n=(o=r.next()).done){c.next=14;break}return s=o.value,c.delegateYield(t(s),"t0",11);case 11:n=!0,c.next=8;break;case 14:c.next=20;break;case 16:c.prev=16,c.t1=c.catch(6),a=!0,i=c.t1;case 20:c.prev=20,c.prev=21,n||null==r.return||r.return();case 23:if(c.prev=23,!a){c.next=26;break}throw i;case 26:return c.finish(23);case 27:return c.finish(20);case 28:case"end":return c.stop()}},t,null,[[6,16,20,28],[21,,23,27]])}),t.delegateYield(e(this),"t0",2);case 2:case"end":return t.stop()}},t,this)})},{key:"postorder",value:R.a.mark(function t(){var e;return R.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=R.a.mark(function t(e){var n,a,i,r,o,s;return R.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!e.children){c.next=26;break}n=!0,a=!1,i=void 0,c.prev=4,r=e.children[Symbol.iterator]();case 6:if(n=(o=r.next()).done){c.next=12;break}return s=o.value,c.delegateYield(t(s),"t0",9);case 9:n=!0,c.next=6;break;case 12:c.next=18;break;case 14:c.prev=14,c.t1=c.catch(4),a=!0,i=c.t1;case 18:c.prev=18,c.prev=19,n||null==r.return||r.return();case 21:if(c.prev=21,!a){c.next=24;break}throw i;case 24:return c.finish(21);case 25:return c.finish(18);case 26:return c.next=28,e;case 28:case"end":return c.stop()}},t,null,[[4,14,18,26],[19,,21,25]])}),t.delegateYield(e(this),"t0",2);case 2:case"end":return t.stop()}},t,this)})},{key:"timeCourse",get:function(){var t=this,e=this.timePoints,n=new Map(e.map(function(e){return[e,{time:new Date(e),cases:t.cases.filter(function(t){return Object(b.j)(t.symptomOnset)-e===0}).length}]}));if(0===this.children.length)n.forEach(function(t){return t.totalDescendents=t.cases});else{var a=this.children.map(function(t){return t.timeCourse}),i=!0,r=!1,o=void 0;try{for(var s,c=a[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value,u=!0,h=!1,d=void 0;try{for(var g,f=l.keys()[Symbol.iterator]();!(u=(g=f.next()).done);u=!0){var v=g.value;-1===e.indexOf(v)&&(e.push(v),n.set(v,{time:new Date(v),cases:0}))}}catch(w){h=!0,d=w}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}}}catch(w){r=!0,o=w}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}var p=!0,m=!1,O=void 0;try{for(var x,j=function(){var t=x.value,e=a.map(function(e){return e.has(t)?e.get(t):{cases:0,totalDescendents:0}}),i=Object(y.k)(e,function(t){return t.totalDescendents}),r=n.get(t);n.set(t,Object(k.a)({},r,{totalDescendents:r.cases+i}))},E=e[Symbol.iterator]();!(p=(x=E.next()).done);p=!0)j()}catch(w){m=!0,O=w}finally{try{p||null==E.return||E.return()}finally{if(m)throw O}}}return n}},{key:"timePoints",get:function(){var t=[Object(y.h)(this.cases,function(t){return t.symptomOnset})],e=[Object(y.e)(this.cases,function(t){return t.symptomOnset})];if(this.children.length>0){var n=!0,a=!1,i=void 0;try{for(var r,o=this.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value.timePoints;t.push(Object(y.h)(s)),e.push(Object(y.e)(s))}}catch(c){a=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}return b.j.range(b.j.offset(Object(y.h)(t),-1),b.j.offset(Object(y.e)(e),2)).map(function(t){return t.getTime()})}}]),t}(),Z=function(t){function e(t,n){var a;return Object(u.a)(this,e),(a=Object(E.a)(this,Object(w.a)(e).call(this))).settings=Object(k.a)({},e.DEFAULT_SETTINGS(),n),a.backgroundOutbreak=new Q("background",null,[]),a.backgroundOutbreak.addChild(t.rootOutbreak),a.gapMap=new Map,a.setGapMap(),a.points=[],a._horizontalRange=[0,1],a._verticalRange=[1,0],a._horizontalTicks=a.settings.horizontalScale().domain(a._horizontalRange).ticks(5),a}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{horizontalRange:null,horizontalTicks:null,horizontalScale:p.a,percent:!1}}}]),Object(h.a)(e,[{key:"setGapMap",value:function(){for(var t=this.backgroundOutbreak.timeCourse,e=0,n=Object(s.a)(this.backgroundOutbreak.preorder());e<n.length;e++){var a=n[e],i=new Map,r=a.timeCourse,o=!0,c=!1,l=void 0;try{for(var u,h=function(){var e=u.value,n=r.has(e)?r.get(e):{time:new Date(e),cases:0,totalDescendents:0};n.percent=0!==t.get(e).totalDescendents?n.totalDescendents/t.get(e).totalDescendents:0;var o=0!==n.totalDescendents?(n.totalDescendents-n.cases)/n.totalDescendents*n.percent:0;o>0&&a.children.filter(function(t){return t.timeCourse.has(e)&&t.timeCourse.get(e).totalDescendents>0}).length;var c=n.percent-o,l=a.children?a.children.length:0,h=Array(Object(y.e)([l-1,0])).fill(.05/(l-1)),d=[.85].concat(Object(s.a)(h),[1-.85-.1]).map(function(t){return t*c});i.set(e,d)},d=a.timePoints[Symbol.iterator]();!(o=(u=d.next()).done);o=!0)h()}catch(g){c=!0,l=g}finally{try{o||null==d.return||d.return()}finally{if(c)throw l}}this.gapMap.set(a,i)}}},{key:"setPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.backgroundOutbreak,e=this.backgroundOutbreak.timeCourse,n=this.gapMap.get(t),a=0,i=new Map(t.timePoints.map(function(t){return[t,n.get(t)[a]]})),r=!0,o=!1,s=void 0;try{for(var c,l=t.children[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var u=c.value,h=[],d=u.timeCourse,g=!0,f=!1,v=void 0;try{for(var p,m=u.timePoints[Symbol.iterator]();!(g=(p=m.next()).done);g=!0){var O=p.value,x=d.get(O);x.percent=e.get(O).totalDescendents>0?x.totalDescendents/e.get(O).totalDescendents:0;var j=tt.call(this,u,O),k={time:O,y1:j-i.get(O),y0:j-i.get(O)-x.percent,data:u,total:e.get(O).totalDescendents};this.settings.percent&&(k.total=1),this.addAnnotations({outbreakId:u.id,location:u.location}),h.push(k),i.set(O,i.get(O)+x.percent+n.get(O)[a+1])}}catch(E){f=!0,v=E}finally{try{g||null==m.return||m.return()}finally{if(f)throw v}}h.length>0?function(){var t=Object(y.e)(h.filter(function(t){return t.y1===t.y0}),function(t){return t.time}),n=h.filter(function(e){return e.time===t})[0],a=Object(y.e)(h.filter(function(t){return t.y1!==t.y0}),function(t){return t.time}),i=h.filter(function(t){return t.time===a})[0];h=h.filter(function(t){return t.time<n.time});var r={time:n.time,y1:(i.y1+i.y0)/2,y0:(i.y1+i.y0)/2,data:i.data,total:n.total};h.push(r);var o=Object(y.h)(h,function(t){return t.time}),s=h.filter(function(t){return t.time===o})[0],c=b.j.offset(o,-1).getTime(),l=e.has(c)&&e.get(c).totalDescendents>0?e.get(c).totalDescendents:0,u={time:c,y1:(s.y1+s.y0)/2,y0:(s.y1+s.y0)/2,data:s.data,total:l};h.unshift(u)}():console.log("no time points found for outbreak ".concat(u.id," The samples may be missing data")),h.sort(function(t,e){return t.time-e.time}),this.points.push(h),a+=1,this.setPoints(u)}}catch(E){o=!0,s=E}finally{try{r||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"layout",value:function(t){this.points=[],this.setPoints(),t.push.apply(t,Object(s.a)(this.points)),this.settings.horizontalRange?this._horizontalRange=this.settings.horizontalRange:this._horizontalRange=Object(y.d)(this.points.reduce(function(t,e){return[].concat(Object(s.a)(t),Object(s.a)(e))},[]),function(t){return new Date(t.time)}),this.settings.horizontalTicks?this._horizontalTicks=this.settings.horizontalTicks:this._horizontalTicks=this.settings.horizontalScale().domain(this._horizontalRange).ticks(5),this._verticalRange=Object(y.d)(this.points.reduce(function(t,e){return[].concat(Object(s.a)(t),Object(s.a)(e))},[]),function(t){return t.total*t.y1})}},{key:"update",value:function(){this.updateCallback()}},{key:"horizontalRange",get:function(){return this._horizontalRange}},{key:"verticalRange",get:function(){return this._verticalRange}},{key:"horizontalAxisTicks",get:function(){return this._horizontalTicks}}]),e}(X);function tt(t,e){var n=this.points.find(function(e){return e[0].data===t.parent});return"undefined"===typeof n?1:n.find(function(t){return t.time===e}).y1}var et=n(29),nt=function(t){function e(t,n,a){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(u.a)(this,e),(i=Object(E.a)(this,Object(w.a)(e).call(this))).layout=n,i.margins=a,i.settings=Object(k.a)({},z.DEFAULT_SETTINGS(),e.DEFAULT_SETTINGS(),r),i.svg=t,i}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{hoverBorder:2,tranitionDuration:0,curve:et.b}}}]),Object(h.a)(e,[{key:"addDataLayers",value:function(){this.svgSelection.append("g").attr("class","area-layer")}},{key:"draw",value:function(){var t,e,n=this;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,Object(N.f)(this.svg).select("g").remove(),Object(N.f)(this.svg).append("g").attr("transform","translate(".concat(this.margins.left,",").concat(this.margins.top,")")),this.svgSelection=Object(N.f)(this.svg).select("g"),this.svgSelection.append("g").attr("class","axes-layer"),this.addDataLayers();var a=this.settings.xScaleType().domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),i=this.settings.yScaleType().domain(this.layout.verticalRange).range([e-this.margins.bottom-this.margins.top,this.margins.top]);this.scales={x:a,y:i,width:t,height:e},this.addAxis(),this.layout.updateCallback=function(){n.update()},this.points=[],this.layout.layout(this.points),this.update()}},{key:"update",value:function(){var t,e;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,this.scales.x.domain(this.layout.horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),this.scales.y.domain(this.layout.verticalRange).range([e-this.margins.bottom-this.margins.top,this.margins.top]),this.scales.width=t,this.scales.height=e,function(){var t=this,e=Object(et.a)().x(function(e){return t.scales.x(new Date(e.time))}).y0(function(e){return t.scales.y(e.y0*e.total)}).y1(function(e){return t.scales.y(e.y1*e.total)}).curve(et.b),n=this.svgSelection.select(".area-layer").selectAll("path").data(this.points,function(t){return t[0].data.id});n.enter().append("path").attr("class",function(e){return["fishArea"].concat(Object(s.a)(t.getAnnotations(e[0].data))).join(" ")}).attr("stroke-width",4).attr("stroke",function(t){return"black"}).attr("d",function(t){return e(t)});n.transition().duration(this.settings.transitionDuration).attr("d",function(t){return e(t)}),n.exit().remove()}.call(this),this.updateAxis()}}]),e}(z);var at=function(){function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return!0};Object(u.a)(this,t),this.outbreaks=[],this.outbreakMap=new Map,this.graph=n,this.edgeCondition=a(this.graph),this.setOutbreaks(e)}return Object(h.a)(t,[{key:"setOutbreaks",value:function(t){var e=new Q("".concat(t.location,"-").concat(t.id),t.location,[t]);this.rootOutbreak=e,e.indexCase=t,this.outbreakMap.set(t,e),this.outbreaks.push(e);var n=this.graph.getOutgoingEdges(t).filter(this.edgeCondition).map(function(t){return{edge:t,Case:t.target}}),a=!0,i=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;this.outbreakTraversal(c)}}catch(l){i=!0,r=l}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"outbreakTraversal",value:function(t){var e=this,n=t.Case,a=t.edge.source,i=this.outbreakMap.get(a);if(!this.outbreakMap.has(n)){if(n.location===a.location)i.addCase(n),n.outbreakId=i.id,this.outbreakMap.set(n,i),i;else{var r=new Q("".concat(n.location,"-").concat(n.id),n.location,[n]);n.outbreakId=r.id,r.indexCase=n,i.addChild(r),this.outbreakMap.set(n,r),this.outbreaks.push(r),r}var o=this.graph.getOutgoingEdges(n).filter(function(t){return e.edgeCondition}).map(function(t){return{edge:t,Case:t.target}}).filter(function(t){return!e.outbreakMap.has(t.Case)}),s=!0,c=!1,l=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;this.outbreakTraversal(d)}}catch(g){c=!0,l=g}finally{try{s||null==h.return||h.return()}finally{if(c)throw l}}}}},{key:"Cases",get:function(){return this.outbreaks.reduce(function(t,e){return[].concat(Object(s.a)(t),Object(s.a)(e.cases))},[])}}]),t}(),it=Object(I.n)("%B %d, %Y"),rt={enter:function(t,e,n){t[0].data;var a=Object(N.g)(n);!Object(N.f)(n[e]).attr("class").includes("selected")&&(a.filter(function(t,a,i){return i[a]!==n[e]}).classed("not-hovered",!0),Object(N.f)(n[e]).classed("hovered",!0));var i=document.getElementById("tooltip"),r=t[0].data.children.map(function(t){return"".concat(t.location," - ").concat(it(t.cases[0].symptomOnset))}).join("<br/>");i.innerHTML="Local circulation\n                        <br/>\n                        Location: ".concat(t[0].data.location,"\n                        <br/>\n                        Cases: ").concat(t[0].data.cases.length,"\n                        ").concat(null!==t[0].data.parent.location?"<br/>\n                             Source: ".concat(t[0].data.parent.location):"","\n                        ").concat(t[0].data.children.length>0?"<br/>Export Events<br/>".concat(r):"","\n                        "),i.style.display="block",i.style.left=I.e.pageX+(I.e.pageX>800?-300:10)+"px",i.style.top=I.e.pageY+10+"px",i.style.visibility="visible"},exit:function(t,e,n){!Object(N.f)(n[e]).attr("class").includes("selected")&&(Object(N.g)(n).classed("not-hovered",!1),Object(N.f)(n[e]).classed("hovered",!1)),document.getElementById("tooltip").style.visibility="hidden"}},ot=function(t,e,n){var a=t[0].data,i=Object(N.g)(n),r=!Object(N.f)(n[e]).attr("class").includes("selected");i.filter(function(t,a,i){return i[a]!==n[e]}).classed("not-selected",r),Object(N.f)(n[e]).classed("selected",r),Object(N.g)(".rect").classed("hidden",r),Object(N.g)(".node").classed("hidden",r),Object(N.g)(".node-background").classed("hidden",r),Object(N.g)(".branch").classed("hidden",r);var o=[];!function t(e,n){n.push.apply(n,Object(s.a)(e.cases));var a=!0,i=!1,r=void 0;try{for(var o,c=e.children[Symbol.iterator]();!(a=(o=c.next()).done);a=!0)t(o.value,n)}catch(l){i=!0,r=l}finally{try{a||null==c.return||c.return()}finally{if(i)throw r}}}(a,o),r&&(o.forEach(function(t){return Object(N.g)(".id-".concat(t.id)).classed("hidden",!r)}),o.forEach(function(t){return Object(N.g)(".source-".concat(t.id)).classed("hidden",!r)}),o.forEach(function(t){return Object(N.g)(".target-".concat(t.id)).classed("hidden",!r)}),o.forEach(function(t){return Object(N.g)(".tip-".concat(t.id)).classed("hidden",!r)}))};var st=function(t){var e=Object(a.useState)(null),n=Object(c.a)(e,2),r=n[0],o=n[1],s=Object(a.useRef)();Object(a.useEffect)(function(){var e=new nt(s.current,t.layout,t.margins,{hoverBorder:4,backgroundBorder:2,tranitionDuration:0});e.draw(),e.onHover(rt,".fishArea"),e.onClick(ot,".fishArea"),o(e)},[]);var l="b".concat(Math.random().toString(36).substring(4));return Object(a.useEffect)(function(){null!==r&&r.update()},[t.chartGeom,t.epidemic]),i.a.createElement("svg",{className:"chart",id:l,ref:s,height:t.chartGeom.height,width:t.chartGeom.width})},ct=(i.a.forwardRef(function(t,e){return i.a.createElement("svg",{className:"chart",ref:e,height:t.chartGeom.height,width:t.chartGeom.width})}),n(50),Object(I.n)("%B %d, %Y")),lt={enter:function(t,e,n,a){Object(N.f)(n[e]).classed("hovered",!0);var i=document.getElementById("tooltip");i.innerHTML="Source: ".concat(t.data.source.id,"\n                        <br/>\n                        Target: ").concat(t.data.target.id,"\n                        <br/>\n                        Data source: ").concat(t.data.metaData.dataSource,"\n                        <br/>\n                        Support:").concat(t.data.metaData.support),i.style.display="block",i.style.left=I.e.pageX+10+"px",i.style.top=I.e.pageY+10+"px",i.style.visibility="visible";for(var r=function(){var t=s[o],e=a.svgSelection.select(".node.id-".concat(t.id)),n=e.select(".node-shape");e.raise(),a.settings.baubles.forEach(function(t){t.vertexFilter(n)&&t.updateShapes(n,a.settings.hoverBorder)}),n.classed("hovered",!0)},o=0,s=[t.data.source,t.data.target];o<s.length;o++)r()},exit:function(t,e,n,a){Object(N.f)(n[e]).classed("hovered",!1),document.getElementById("tooltip").style.visibility="hidden";for(var i=function(){var t=o[r],e=a.svgSelection.select(".node.id-".concat(t.id)).select(".node-shape");a.settings.baubles.forEach(function(t){t.vertexFilter(e)&&t.updateShapes(e,0)}),e.classed("hovered",!1)},r=0,o=[t.data.source,t.data.target];r<o.length;r++)i()}},ut={enter:function(t,e,n,a){var i=document.getElementById("tooltip");i.innerHTML="Case Id: ".concat(t.node.id,"\n                        <br/>\n                        Location: ").concat(t.node.location,"\n                        <br/>\n                        Symptom onset: ").concat(ct(t.node.symptomOnset)),i.style.display="block",i.style.left=I.e.pageX+10+"px",i.style.top=I.e.pageY+10+"px",i.style.visibility="visible";var r=a.svgSelection.selectAll(".branch.target-".concat(t.node.id));r.raise(),r.select(".branch-path").classed("hovered",!0);var o=a.svgSelection.selectAll(".branch.source-".concat(t.node.id));o.raise(),o.select(".branch-path").classed("hovered",!0);for(var c=a.layout.graph.getIncomingEdges(t.node).map(function(t){return t.source}),l=0,u=Object(s.a)(c);l<u.length;l++){var h=u[l];a.highlightNode(h.id,"source")}for(var d=a.layout.graph.getOutgoingEdges(t.node).map(function(t){return t.target}),g=0,f=Object(s.a)(d);g<f.length;g++){var v=f[g];a.highlightNode(v.id,"transmission")}var p=Object(N.f)(n[e]).classed("hovered",!0);a.settings.baubles.forEach(function(t){t.vertexFilter(p)&&t.updateShapes(p,a.settings.hoverBorder)}),Object(N.f)(n[e].parentNode).raise()},exit:function(t,e,n,a){var i=Object(N.f)(n[e]).classed("hovered",!1);a.settings.baubles.forEach(function(t){t.vertexFilter(i)&&t.updateShapes(i,0)}),document.getElementById("tooltip").style.visibility="hidden",a.svgSelection.selectAll(".branch.target-".concat(t.node.id)).select(".branch-path").classed("hovered",!1),a.svgSelection.selectAll(".branch.source-".concat(t.node.id)).select(".branch-path").classed("hovered",!1);var r=a.layout.graph.getIncomingEdges(t.node).map(function(t){return t.source}),o=!0,c=!1,l=void 0;try{for(var u,h=r[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var d=u.value;a.svgSelection.select(".node.id-".concat(d.id)).select(".node-shape").attr("class").includes("selected")?a.unHighlightNode(d.id,""):a.unHighlightNode(d.id,"source")}}catch(b){c=!0,l=b}finally{try{o||null==h.return||h.return()}finally{if(c)throw l}}for(var g=a.layout.graph.getOutgoingEdges(t.node).map(function(t){return t.target}),f=0,v=Object(s.a)(g);f<v.length;f++){var p=v[f];a.svgSelection.select(".node.id-".concat(p.id)).select(".node-shape").attr("class").includes("selected")?a.unHighlightNode(p.id,""):a.unHighlightNode(p.id,"transmission")}}};var ht=function(t){var e=function(e,n,a,i){var r=!Object(N.f)(a[n]).attr("class").includes("selected");r?t.setSelectedCases([].concat(Object(s.a)(t.selectedCases),[e.node])):t.setSelectedCases(t.selectedCases.filter(function(t){return t!==t.node})),Object(N.g)(".selected").classed("selected source transmission",!1),Object(N.f)(a[n]).classed("selected",r),Object(N.g)(".id-".concat(e.node.id)).classed("selected",r),Object(N.g)(".id-".concat(e.node.id)).select(".node-shape").classed("selected",r),Object(N.g)(".id-".concat(e.node.id)).select(".branch-path").classed("selected",r),i.svgSelection.selectAll(".branch.target-".concat(e.node.id)).select(".branch-path").classed("selected",r),i.svgSelection.selectAll(".branch.source-".concat(e.node.id)).select(".branch-path").classed("selected",r);var o=i.layout.graph.getIncomingEdges(e.node).map(function(t){return t.source}),c=!0,l=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var g=h.value;i.svgSelection.select(".node.id-".concat(g.id)).select(".node-shape").classed("selected source",r),Object(N.g)(".tip-".concat(g.id)).classed("selected source",r),Object(N.g)(".id-".concat(g.id," ")).select(".node-shape").classed("selected source",r),Object(N.g)(".tip-".concat(g.id)).select(".branch-path").classed("selected transmission",r)}}catch(x){l=!0,u=x}finally{try{c||null==d.return||d.return()}finally{if(l)throw u}}var f=i.layout.graph.getOutgoingEdges(e.node).map(function(t){return t.target}),v=!0,p=!1,b=void 0;try{for(var y,m=f[Symbol.iterator]();!(v=(y=m.next()).done);v=!0){var O=y.value;i.svgSelection.select(".node.id-".concat(O.id)).select(".node-shape").classed("selected transmission",r),Object(N.g)(".tip-".concat(O.id)).classed("selected transmission",r),Object(N.g)(".id-".concat(O.id)).select(".node-shape").classed("selected transmission",r),Object(N.g)(".tip-".concat(O.id)).select(".branch-path").classed("selected transmission",r)}}catch(x){p=!0,b=x}finally{try{v||null==m.return||m.return()}finally{if(p)throw b}}},n=Object(a.useState)(null),r=Object(c.a)(n,2),o=r[0],l=r[1],u=Object(a.useRef)();Object(a.useEffect)(function(){var n={hoverBorder:4,backgroundBorder:2,baubles:[new P],tranitionDuration:0,opacityFunc:function(t){return t.data.metaData.support}},a=new H(u.current,t.layout,t.margins,n);a.draw(),a.onHoverNode(ut),a.onClickNode(e),a.onHoverBranch(lt),Object(N.f)(u.current).select(".axes-layer").remove(),l(a)},[]),Object(a.useEffect)(function(){o&&o.update()},[t.chartGeom.width,t.chartGeom.height]);var h="b".concat(Math.random().toString(36).substring(4));return i.a.createElement("svg",{className:"chart",id:h,ref:u,height:t.chartGeom.height,width:t.chartGeom.width})},dt=function(t){function e(t,n,a){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(u.a)(this,e),(i=Object(E.a)(this,Object(w.a)(e).call(this))).layout=n,i.settings=Object(k.a)({},e.DEFAULT_SETTINGS(),r),i._horizontalRange=i.settings.horizontalRange,i.svg=t,i.margins=a,i}return Object(S.a)(e,t),Object(h.a)(e,null,[{key:"DEFAULT_SETTINGS",value:function(){return{transitionDuration:0,horizontalRange:[0,1],horizontalAxisTicks:[0,.5,1],horizontalScale:p.a}}}]),Object(h.a)(e,[{key:"draw",value:function(){var t,e;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,this.scales={x:this.settings.horizontalScale().domain(this._horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),width:t,height:e},Object(N.f)(this.svg).select("g").remove(),Object(N.f)(this.svg).append("g").attr("transform","translate(".concat(this.margins.left,",").concat(this.margins.top,")")),this.svgSelection=Object(N.f)(this.svg).select("g"),this.svgSelection.append("g").attr("class","axes-layer"),this.svgSelection.select(".axes-layer").append("g").attr("class","top axis").attr("id","x-axis-top").call(Object(T.c)(this.scales.x).tickValues(this.layout.horizontalAxisTicks)),this.svgSelection.select(".axes-layer").append("g").attr("transform","translate(0,".concat(this.scales.height-this.margins.bottom-this.margins.top-50,")")).attr("class","bottom axis").attr("id","x-axis-bottom").call(Object(T.a)(this.scales.x).tickValues(this.layout.horizontalAxisTicks))}},{key:"update",value:function(){var t,e;t=Object.keys(this.settings).indexOf("width")>-1?this.settings.width:this.svg.getBoundingClientRect().width,e=Object.keys(this.settings).indexOf("height")>-1?this.settings.height:this.svg.getBoundingClientRect().height,this.scales={x:this.settings.horizontalScale().domain(this._horizontalRange).range([this.margins.left,t-this.margins.right-this.margins.left]),width:t,height:e},this.svgSelection.select("#x-axis-top").call(Object(T.c)(this.scales.x).tickValues(this.layout.horizontalAxisTicks.map(function(t,e){return e%2===0?t:""}))).transition().duration(this.settings.transitionDuration).ease(A.b),this.svgSelection.select("#x-axis-bottom").attr("transform","translate(0,".concat(this.scales.height-this.margins.bottom-this.margins.top,")")).call(Object(T.a)(this.scales.x).tickValues(this.layout.horizontalAxisTicks.map(function(t,e){return e%2===0?t:""}))).transition().duration(this.settings.transitionDuration),this.updateAxisBars()}},{key:"horizontalRange",get:function(){return this._horizontalRange}}]),e}(z);var gt=function(t){var e=Object(a.useState)(null),n=Object(c.a)(e,2),r=n[0],o=n[1],s=Object(a.useCallback)(function(e){if(null!==e)if(0===e.children.length){var n={horizontalRange:Object(y.d)(t.dateRange),horizontalAxisTicks:t.dateRange,horizontalScale:p.b,tranitionDuration:0},a=Object(k.a)({},t.margins,{top:30,bottom:25}),i=new dt(e,n,a,n);i.draw(),o(i)}else r.update()}),l="b".concat(Math.random().toString(36).substring(4));return i.a.createElement("svg",{id:l,ref:s,height:t.domRect.height+20+20+20,width:t.chartGeom.width})},ft=(n(51),n(52),function(t,e,n){var a=document.getElementById("timeline");t.altKey?(a.style.left=t.pageX+"px",a.style.transition="none",a.style.opacity="1",a.style.visibility="visible"):(a.style.transition="0.5s",a.style.opacity="0",a.style.visibility="hidden")}),vt=function(t,e,n){document.getElementById("timeline").style.visibility="hidden"},pt=i.a.forwardRef(function(t,e){var n=Object(a.useState)({height:300,width:1200}),r=Object(c.a)(n,2),o=r[0],s=r[1],l={top:10,bottom:10,left:50,right:50};return Object(a.useEffect)(function(){if(null!==t.timelineSize){var e={height:300,width:.94*t.timelineSize.width};s(e)}},[t.timelineSize]),Object.values(t).every(function(t){return null!==t&""!==t})?(console.log("reRender"),i.a.createElement("div",{className:"timelineContainer",ref:e,onMouseMove:ft,onMouseLeave:vt},i.a.createElement("div",{id:"timeline"}),i.a.createElement("div",{className:"hoverInfo",id:"tooltip"}),i.a.createElement("div",{className:"mockChartContainer"},i.a.createElement(gt,{dateRange:t.dateRange,margins:l,chartGeom:o,domRect:t.timelineSize})),i.a.createElement("div",{className:"chartContainer"},i.a.createElement(K,{data:t.epidemic.Cases,margins:l,layout:t.stackedLayout,chartGeom:o,dateRange:t.dateRange,callbacks:{groups:function(t){return t.location}}}),i.a.createElement("div",{className:"chartTitle"},"Case plot")),i.a.createElement("div",{className:"chartContainer"},i.a.createElement(st,{layout:t.areaLayout,selectArea:t.selectArea,margins:l,epidemic:t.epidemic,dateRange:t.dateRange,chartGeom:Object(k.a)({},o,{height:400})}),i.a.createElement("div",{className:"chartTitle"},"Outbreaks")),i.a.createElement("div",{className:"chartContainer"},i.a.createElement(ht,{margins:l,treeDateRange:t.treeDateRange,phylogeny:t.phylogeny,graph:t.epidemic.graph,dateRange:t.dateRange,curve:"bezier",layout:t.transmissionLayout,chartGeom:o,setSelectedCases:t.setSelectedCases,selectedCases:t.selectedCases}),i.a.createElement("div",{className:"chartTitle"},"Case connections")),i.a.createElement("div",{className:"chartContainer"},i.a.createElement($,{margins:l,dateRange:t.dateRange,treeDateRange:t.treeDateRange,phylogeny:t.phylogeny,layout:F,chartGeom:Object(k.a)({},o,{height:600})}),i.a.createElement("div",{className:"chartTitle"},"Transmission tree")))):i.a.createElement("div",{className:"timelineContainer",ref:e})}),bt=n(34),yt=Object(I.n)("%B %d, %Y");var mt=function(t){var e=[{id:"id",Header:"Case Id",accessor:function(t){return t.id}},{id:"location",Header:"Location",accessor:function(t){return t.location}},{id:"symptomOnset",Header:"Symptom Onset",accessor:function(t){return t.symptomOnset},Cell:function(t){return null===t.value?i.a.createElement("span",null,"Unknown"):i.a.createElement("span",null,yt(t.value))},filterable:!1}],n=[{id:"source",Header:"Source",accessor:function(t){return t.source.id}},{id:"dataSource",Header:"Data Source",accessor:function(t){return t.metaData.dataSource}},{id:"support",Header:"Support",accessor:function(t){return t.metaData.support}}],a=[{id:"target",Header:"Target",accessor:function(t){return t.target.id}},{id:"dataSource",Header:"Data Source",accessor:function(t){return t.metaData.dataSource}},{id:"support",Header:"Support",accessor:function(t){return t.metaData.support}}],r={display:"inline-block",marginRight:"10px",marginLeft:"10px"},o=t.epidemic.Cases.length,s=t.selectedCases.length>0?t.epidemic.Cases.filter(function(e){return t.selectedCases.map(function(t){return t.id}).indexOf(e.id)>-1}):t.epidemic.Cases;return i.a.createElement(bt.a,{showPagination:!1,defaultPageSize:o,data:s,columns:e,filterable:!0,className:"-striped -highlight",SubComponent:function(e){var o=t.epidemic.graph.getIncomingEdges(e.original),s=t.epidemic.graph.getOutgoingEdges(e.original);return i.a.createElement("div",null,i.a.createElement("div",{style:r,className:"legendSquare source"}),i.a.createElement("div",{style:r},i.a.createElement("h4",null," Putative sources of infection ")," "),i.a.createElement(bt.a,{showPagination:!1,defaultPageSize:o.length,data:o,className:"-striped -highlight",columns:n}),i.a.createElement("div",{style:r,className:"legendSquare  transmission"}),i.a.createElement("div",{style:r},i.a.createElement("h4",null," Putative Transmissions ")," "),"            ",i.a.createElement(bt.a,{showPagination:!1,defaultPageSize:s.length,data:s,className:"-striped -highlight",columns:a}))}})},Ot=n(31),xt=n(28),jt=n(33);var kt=function(t){var e,n,r=Object(a.useState)(null),o=Object(c.a)(r,2),s=(o[0],o[1],t.size.width),l=t.size.height,u=t.data,h=Object(jt.a)(u,u.objects.adm0),d=Object(jt.a)(u,u.objects.adm1),g=u.objects.adm2?Object(jt.a)(u,u.objects.adm2):null;e=h.features.map(function(t){return t.id}).indexOf("UGA")>-1?Object(xt.a)().center([29.046,.7918]).scale(4e3).translate([s/2,l/2]):Object(xt.a)().center([-4,54.5]).scale(3e3).translate([s/2,l/2]),n=Object(xt.b)().projection(e);var f=Object(a.useRef)(),v=Object(I.m)(f.current).append("g");return v.append("rect").attr("class","map-background").attr("width",s).attr("height",l),v.append("g").attr("id","adm0").selectAll("path").data(h.features).enter().append("path").attr("class","adm0").attr("id",function(t){return t.properties.name.replace(" ","-")}).attr("d",n),v.append("g").attr("id","adm1").selectAll("path").data(d.features).enter().append("path").attr("class","adm1").attr("id",function(t){return t.properties.name.replace(" ","-")}).attr("d",n),g&&v.append("g").attr("id","adm2").selectAll("path").data(g.features).enter().append("path").attr("class","adm2").attr("id",function(t){return t.properties.name.replace(" ","-")}).attr("d",n),i.a.createElement("svg",{className:"chart",id:"map",ref:f,height:t.size.height,width:t.size.width})},Et=(I.o("%Y-%m-%d"),function(t){var e=Object(m.b)().key(function(t){return t.target}).key(function(t){return t.source}).key(function(t){return t.dataSource}).entries(t),n=[];t.forEach(function(t){-1===n.indexOf(t.dataSource)&&n.push(t.dataSource)});var a=[],i=!0,r=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){for(var l=s.value,u=l.key,h={},d=function(){var t=f[g];h[t]=l.values.map(function(e){return e.values.filter(function(e){return e.key===t})}).reduce(function(t,e){return t.concat(e)},[]).reduce(function(t,e){return t+e.values.length},0)},g=0,f=n;g<f.length;g++)d();var v=!0,p=!1,b=void 0;try{for(var y,O=l.values[Symbol.iterator]();!(v=(y=O.next()).done);v=!0){var x=y.value,j=x.key,k=!0,E=!1,w=void 0;try{for(var S,T=x.values[Symbol.iterator]();!(k=(S=T.next()).done);k=!0){var N=S.value,A={};A.dataSource=N.key,A.support=N.values.length/h[N.key],a.push({target:u,source:j,metaData:A})}}catch(L){E=!0,w=L}finally{try{k||null==T.return||T.return()}finally{if(E)throw w}}}}catch(L){p=!0,b=L}finally{try{v||null==O.return||O.return()}finally{if(p)throw b}}}}catch(L){r=!0,o=L}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}return a});n(57),n(58);var wt=function(){var t=Object(a.useState)(!1),e=Object(c.a)(t,2),n=e[0],r=e[1],o=Object(a.useState)(!1),u=Object(c.a)(o,2),h=u[0],f=u[1],m=Object(a.useState)(null),O=Object(c.a)(m,2),x=O[0],k=O[1],E=Object(a.useState)("Geography"),w=Object(c.a)(E,2),S=w[0],T=w[1],N=Object(a.useCallback)(function(t){if(null!==t){k({height:t.getBoundingClientRect().height,width:t.getBoundingClientRect().width});var e=function(){var e;clearTimeout(e),e=setTimeout(function(){k({height:t.getBoundingClientRect().height,width:t.getBoundingClientRect().width})},250)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}},[]),A=function(){var t;clearTimeout(t),t=setTimeout(function(){window.dispatchEvent(new Event("resize"))},0)},L="https://raw.githubusercontent.com/jtmccr1/trapper/master/examples/simulated",R=Object(a.useState)(null),D=Object(c.a)(R,2),I=D[0],z=D[1],M=Object(a.useState)(null),B=Object(c.a)(M,2),F=B[0],_=B[1],U=Object(a.useState)(null),P=Object(c.a)(U,2),H=P[0],Y=P[1],X=Object(a.useState)(null),V=Object(c.a)(X,2),J=V[0],K=V[1],$=Object(a.useState)(null),Q=Object(c.a)($,2),tt=Q[0],et=Q[1],nt=Object(a.useState)([]),it=Object(c.a)(nt,2),rt=it[0],ot=it[1],st=Object(a.useState)(null),ct=Object(c.a)(st,2),lt=ct[0],ut=ct[1],ht=Object(a.useState)(null),dt=Object(c.a)(ht,2),gt=dt[0],ft=dt[1],vt=Object(a.useState)(null),bt=Object(c.a)(vt,2),yt=bt[0],xt=bt[1],jt=function(t){var e=Object(a.useState)(function(){return t}),n=Object(c.a)(e,2),i=n[0],r=n[1];return[i,function(t){r(function(){return t})}]}(function(){return console.log("test")}),wt=Object(c.a)(jt,2),St=wt[0],Tt=wt[1];function Nt(t){return function(e){var n=e.target,a=t.getIncomingEdges(n),i=Object(y.e)(a.filter(function(t){return"transphylo"===t.metaData.dataSource}),function(t){return t.metaData.support});return e===a.find(function(t){return"transphylo"===t.metaData.dataSource&&t.metaData.support===i})}}return Object(a.useEffect)(function(){console.log("reading in the data"),Promise.all([Object(l.a)("".concat(L,"/lineList.csv")),Object(l.a)("".concat(L,"/links.csv")),fetch("".concat(L,"/tree.nwk")),fetch("".concat(L,"/treeAnnotations.json"))]).then(function(t){for(var e=Object(c.a)(t,4),n=e[0],a=e[1],i=e[2],r=e[3],o=n.map(function(t){var e={id:t.id,symptomOnset:v(t.symptomOnset),sampleDate:[v(t.sampleDate)],location:t.location,resolution:t.Outcome};return new d(e)}),l=a.map(function(t){return new g(t)}),u=Et(l),h=u.map(function(t){return t.source}).reduce(function(t,e){return-1===t.indexOf(e)?t.concat(e):t},[]),f=u.map(function(t){return t.target}).reduce(function(t,e){return-1===t.indexOf(e)?t.concat(e):t},[]),m=Object(s.a)(o),O=function(){var t=j[x];if(0===m.filter(function(e){return e.id===t}).length)if(console.log("".concat(t," present in links but not lineList all links are removed")),t.includes("root")){var e=new d({id:t});m.push(e)}else u=(u=u.filter(function(e){return e.source!==t})).filter(function(e){return e.target!==t})},x=0,j=[].concat(Object(s.a)(h),Object(s.a)(f));x<j.length;x++)O();var k,E=u.filter(function(t){return t.metaData.support>.02}),w=new W(m,E),S=w.nodes.find(function(t){return w.getOutgoingEdges(t).length>0&&0===w.getIncomingEdges(t).length});if("Unknown"===S.location){S.symptomOnset=null;var T=w.getOutgoingEdges(S).filter(function(t){return Nt(w)(t)}).map(function(t){return t.target.location});S.location=(k=T).sort(function(t,e){return k.filter(function(e){return e===t}).length-k.filter(function(t){return t===e}).length}).pop()}var N=new at(S,w,Nt);Y(N),Promise.all([i.text(),r.json()]).then(function(t){var e=Object(c.a)(t,2),n=e[0],a=e[1],i=C.parseNewick(n);if(i.annotateNodesFromLabel(a),!i.annotations.hasOwnProperty("location")){var r={};o.forEach(function(t){r[t.id]={location:t.location}}),i.annotateTips(r),i.annotateNodesFromTips("location")}i.order(),z(i);var l=Object(y.d)(w.nodes,function(t){return t.symptomOnset}),u=Object(y.e)(i.nodes,function(t){return i.rootToTipLength(t)}),h=i.nodes.find(function(t){return i.rootToTipLength(t)===u}),d=Object(y.e)(w.getNode(h.name).sampleDate),g=b.a.offset(d,-1*u*365),f=Object(y.d)([g].concat(Object(s.a)(l),[d])),v=b.j.offset(b.j.floor(f[0]),-1),m=b.j.offset(b.j.ceil(f[1]),2);_(b.j.range(v,m)),K([g,d]);var O={horizontalRange:Object(y.d)(b.j.range(v,m)),horizontalTicks:b.j.range(v,m),horizontalScale:p.b,groupingFunction:function(t){return t.location}};xt(new q(N.Cases,O)),ut(new Z(N,O));var x=Object(p.b)().domain(O.horizontalRange).range([0,1]);Tt(function(t){Y(t),xt(new q(N.Cases,O)),ut(new Z(N,O));var e=Object(p.b)().domain(O.horizontalRange).range([0,1]);ft(new G(N.graph,{xFunction:function(t,n){return"UnsampledrootCase"===t.id?e(g[0]):e(t.symptomOnset)},curve:"bezier"}))}),ft(new G(N.graph,{xFunction:function(t,e){return"UnsampledrootCase"===t.id?x(g[0]):x(t.symptomOnset)},curve:"bezier"}))})}),fetch("".concat(L,"/map.json")).then(function(t){return t.json()}).then(function(t){return et(t)})},[]),i.a.createElement("div",{className:"fillHorizontalSpace"},i.a.createElement(j,null),i.a.createElement("div",{className:"mainScreen"},i.a.createElement("div",{className:"sidebar left ".concat(n?"open":"")}),i.a.createElement("div",{className:"sidebarButtonColumn"},i.a.createElement("div",{className:"sidebarButtons left"},i.a.createElement("h3",{className:"button",onClick:function(){r(!n),A()}},i.a.createElement("div",{className:"button-icon"},i.a.createElement(Ot.c,null)),i.a.createElement("div",{className:"rotate-plus-ninety"},"Options")))),i.a.createElement(pt,{ref:N,timelineSize:x,dateRange:F,treeDateRange:J,epidemic:H,phylogeny:I,stackedLayout:yt,areaLayout:lt,transmissionLayout:gt,setSelectedCases:ot,selectedCases:rt,selectArea:St}),i.a.createElement("div",{className:"sidebarButtonColumn"},i.a.createElement("div",{className:"sidebarButtons right"},i.a.createElement("h3",{className:"button ".concat(h&&"Geography"===S?"selected":""),onClick:function(){h&&"Geography"!==S?T("Geography"):(f(!h),T("Geography")),A()}},i.a.createElement("div",{className:"button-icon"},i.a.createElement(Ot.b,null)),i.a.createElement("div",{class:"button-text rotate-minus-ninety"},"Map")),i.a.createElement("h3",{className:"button ".concat(h&&"LineList"===S?"selected":""),onClick:function(){h&&"LineList"!==S?T("LineList"):(f(!h),T("LineList")),A()}},i.a.createElement("div",{className:"button-icon"},i.a.createElement(Ot.a,null)),i.a.createElement("div",{className:"button-text rotate-minus-ninety"},"Line List")))),i.a.createElement("div",{className:"sidebar right ".concat(h?"open":"")},"Geography"===S?i.a.createElement("div",{className:"geographyContainer"},tt?i.a.createElement(kt,{data:tt,margins:{top:5,bottom:5,left:5,right:5},size:{height:500,width:500}}):i.a.createElement("h3",null,"Loading Map")):i.a.createElement(mt,{epidemic:H,selectedCases:rt}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(wt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.8c7e34e6.chunk.js.map